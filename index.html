<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prompt Crafter Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg:#f4f6ff;
      --card:#ffffff;
      --text:#121826;
      --muted:#6b7280;
      --brand:#4f46e5;
      --brand-2:#22c55e;
      --brand-3:#0284c7;
      --brand-4:#7c3aed;
      --brand-5:#f97316;
      --brand-6:#10b981;
      --ring:rgba(79,70,229,.25);
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }
    .container{max-width:1000px;margin:32px auto;padding:0 20px}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
    .logo{
      width:36px;height:36px;border-radius:10px;
      background: conic-gradient(from 180deg at 50% 50%, #06b6d4, #f59e0b, #ef4444, #06b6d4);
      display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:18px;
    }
    h1{font-size:28px;margin:0}
    .subtitle{color:var(--muted);font-size:14px;margin:6px 0 0}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;
      box-shadow:0 1px 1px rgba(0,0,0,.02), 0 6px 24px rgba(0,0,0,.04);
      padding:18px 18px;
      margin-bottom:16px;
    }
    .section-title{font-weight:600;margin:2px 0 10px;display:flex;align-items:center;justify-content:space-between;gap:8px;}
    .section-title i{color:var(--brand)}
    .section-title .actions{display:flex;gap:8px;}
    textarea, .output{
      width:100%;border:1px solid var(--border);border-radius:12px;background:#fff;color:var(--text);
      padding:14px;font-size:14px;outline:none;resize:vertical;min-height:120px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    textarea:focus, .output:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
    .btn{
      user-select:none;display:inline-flex;align-items:center;justify-content:center;
      gap:8px;padding:12px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:600;color:#fff;
      transition:.18s transform ease, .18s opacity ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.convert{background:var(--brand);width:100%;margin:14px 0}
    .btn.convert:disabled{opacity:0.6;cursor:not-allowed;}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .btn.small{padding:10px 14px;font-size:14px;border-radius:10px}
    .btn.copy{background:#111827}
    .btn.claude{background:#111827}
    .btn.chatgpt{background:var(--brand-3)}
    .btn.gemini{background:var(--brand-4)}
    .btn.perplexity{background:var(--brand-5)}
    .btn.deepseek{background:var(--brand-6)}
    .btn.export{background:var(--brand-2)}
    .btn.history{background:#6b7280}
    .btn.templates{background:#8b5cf6}
    .muted{color:var(--muted);font-size:12px;margin-top:10px}
    .howto li{margin:6px 0}
    .topbar{
      display:flex;justify-content:space-between;align-items:center;margin:10px 0 18px;
    }
    .api-box{display:flex;gap:8px;align-items:center;}
    .api-input{
      width:320px;max-width:60vw;
      border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:13px;outline:none;background:#fff;
    }
    .api-input:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
    .btn.save{background:#10b981}
    .footer{color:var(--muted);font-size:12px;margin:18px 0;text-align:center}
    
    /* New Styles */
    .examples{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .example-btn{
      background:#f3f4f6;border:1px solid var(--border);border-radius:8px;
      padding:6px 12px;font-size:12px;cursor:pointer;transition:all 0.2s;
    }
    .example-btn:hover{background:#e5e7eb}
    
    .preset-selector{margin:12px 0}
    .preset-option{
      display:inline-flex;align-items:center;gap:6px;margin-right:12px;
      padding:6px 12px;background:#f3f4f6;border-radius:8px;cursor:pointer;
      font-size:13px;
    }
    .preset-option.active{background:var(--brand);color:white}
    
    .history-panel{display:none;margin-top:12px;border-top:1px solid var(--border);padding-top:12px}
    .history-item{
      background:#f9fafb;padding:8px 12px;margin-bottom:6px;border-radius:8px;
      border-left:3px solid var(--brand);cursor:pointer;font-size:13px;
      display:flex;justify-content:space-between;align-items:center;
    }
    .history-item:hover{background:#f3f4f6}
    
    .tooltip{
      position:relative;display:inline-block;
    }
    .tooltip .tooltiptext{
      visibility:hidden;width:200px;background-color:#111827;color:#fff;
      text-align:center;border-radius:6px;padding:5px;position:absolute;
      z-index:1;bottom:125%;left:50%;margin-left:-100px;font-size:12px;
      opacity:0;transition:opacity 0.3s;
    }
    .tooltip:hover .tooltiptext{visibility:visible;opacity:1}
    
    .stats{font-size:12px;color:var(--muted);margin-top:8px}
    
    .auto-convert{display:flex;align-items:center;gap:8px;margin:10px 0;font-size:13px}
    .auto-convert input{width:16px;height:16px}
    
    .notification{
      position:fixed;bottom:20px;right:20px;background:var(--brand-2);color:white;
      padding:12px 16px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
      display:none;align-items:center;gap:8px;z-index:1000;
    }
    
    .converted-badge{
      display:inline-flex;align-items:center;gap:4px;
      background:#dcfce7;color:#166534;padding:4px 8px;border-radius:6px;
      font-size:12px;margin-left:8px;
    }
    
    .timer-display{
      font-size:11px;color:var(--muted);margin-left:8px;
      display:inline-flex;align-items:center;gap:2px;
    }
    
    /* Template Library Styles */
    .template-categories{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .template-category{
      background:#f3f4f6;padding:6px 12px;border-radius:20px;font-size:12px;
      cursor:pointer;transition:all 0.2s;
    }
    .template-category.active{background:var(--brand);color:white}
    
    .templates-grid{
      display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
      gap:12px;margin-top:12px;
    }
    
    .template-card{
      background:white;border:1px solid var(--border);border-radius:10px;
      padding:14px;cursor:pointer;transition:all 0.2s;
      display:flex;flex-direction:column;height:100%;
    }
    .template-card:hover{
      transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.08);
      border-color:var(--brand);
    }
    
    .template-icon{
      width:36px;height:36px;border-radius:8px;display:flex;
      align-items:center;justify-content:center;margin-bottom:10px;
      color:white;font-size:16px;
    }
    
    .template-title{font-weight:600;margin-bottom:6px;font-size:14px}
    .template-desc{font-size:12px;color:var(--muted);margin-bottom:10px;flex-grow:1}
    .template-meta{display:flex;justify-content:space-between;font-size:11px;color:var(--muted)}
    
    .template-modal{
      display:none;position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);z-index:3000;align-items:center;justify-content:center;
      padding:20px;
    }
    
    .template-modal-content{
      background:white;border-radius:14px;width:100%;max-width:600px;
      max-height:90vh;overflow-y:auto;position:relative;
    }
    
    .template-modal-header{
      padding:20px;border-bottom:1px solid var(--border);
      display:flex;justify-content:space-between;align-items:center;
    }
    
    .template-modal-body{padding:20px;}
    
    .form-group{margin-bottom:16px;}
    .form-label{display:block;margin-bottom:6px;font-weight:500;font-size:14px}
    .form-input{
      width:100%;padding:10px;border:1px solid var(--border);
      border-radius:8px;font-size:14px;
    }
    .form-input:focus{border-color:var(--brand);outline:none}
    
    .tag{display:inline-flex;align-items:center;gap:4px;background:#f3f4f6;
      padding:4px 8px;border-radius:6px;font-size:12px;margin-right:6px;margin-bottom:6px;}
    
    .close-modal{background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted)}
    
    /* Template actions */
    .template-actions{display:flex;gap:8px;margin-top:8px}
    .template-actions .btn.small{padding:6px 10px;font-size:12px}
    
    /* Search box */
    .search-box{
      width:100%;padding:10px 14px;border:1px solid var(--border);
      border-radius:8px;margin-bottom:12px;font-size:14px;
    }
    
    .empty-state{
      text-align:center;padding:40px 20px;color:var(--muted);
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="topbar">
      <div class="header">
        <div class="logo">PC</div>
        <div>
          <h1>Prompt Crafter Pro</h1>
          <div class="subtitle">Transform ideas into structured prompts · Created by Vijay Kumar</div>
        </div>
      </div>

      <div class="api-box">
        <input id="apiKey" class="api-input" type="password" placeholder="Optional: OpenAI API Key" />
        <button class="btn small save" id="saveKeyBtn">Save</button>
      </div>
    </div>

    <!-- TEMPLATE LIBRARY -->
    <div class="card">
      <div class="section-title">
        <div><i class="fas fa-layer-group"></i> Template Library</div>
        <div class="actions">
          <button class="btn small templates" id="newTemplateBtn"><i class="fas fa-plus"></i> New Template</button>
          <button class="btn small templates" id="toggleTemplatesBtn"><i class="fas fa-eye"></i> Show</button>
        </div>
      </div>
      
      <div id="templatesPanel" style="display:none">
        <input type="text" id="templateSearch" class="search-box" placeholder="Search templates...">
        
        <div class="template-categories" id="templateCategories">
          <!-- Categories will be populated by JS -->
        </div>
        
        <div class="templates-grid" id="templatesGrid">
          <!-- Templates will be populated by JS -->
        </div>
        
        <div id="emptyTemplates" class="empty-state" style="display:none">
          <i class="fas fa-inbox" style="font-size:48px;margin-bottom:12px;opacity:0.5"></i>
          <p>No templates found. Create your first template!</p>
        </div>
      </div>
    </div>

    <!-- QUICK EXAMPLES -->
    <div class="card">
      <div class="section-title"><i class="fas fa-bolt"></i> Quick Examples</div>
      <div class="examples">
        <button class="example-btn" data-example="Write a professional email to my team about the deadline extension">Email</button>
        <button class="example-btn" data-example="Create a Python function to calculate Fibonacci sequence">Code</button>
        <button class="example-btn" data-example="Analyze the market trends for electric vehicles in 2024">Analysis</button>
        <button class="example-btn" data-example="Write a blog post about the benefits of meditation">Blog Post</button>
        <button class="example-btn" data-example="Design a workout plan for beginners">Workout Plan</button>
      </div>
    </div>

    <!-- INPUT CARD -->
    <div class="card">
      <div class="section-title"><i class="fas fa-edit"></i> Your Requirement
        <span id="convertedBadge" class="converted-badge" style="display:none">
          <i class="fas fa-check-circle"></i> Converted
        </span>
        <span id="timerDisplay" class="timer-display" style="display:none">
          <i class="fas fa-clock"></i> <span id="timerValue">60s</span>
        </span>
      </div>
      
      <div class="auto-convert">
        <input type="checkbox" id="autoConvert" checked>
        <label for="autoConvert">Auto-convert as I type (60s delay)</label>
      </div>
      
      <textarea id="requirement" placeholder="Type your requirement here..."></textarea>
      <button id="convertBtn" class="btn convert"><i class="fas fa-magic"></i> Convert to Prompt</button>
    </div>

    <!-- PRESET SELECTOR -->
    <div class="card">
      <div class="section-title"><i class="fas fa-sliders-h"></i> Prompt Style</div>
      <div class="preset-selector">
        <div class="preset-option active" data-preset="default">
          <i class="fas fa-check-circle"></i> Standard
        </div>
        <div class="preset-option" data-preset="claude">
          <i class="fas fa-robot"></i> Claude Optimized
        </div>
        <div class="preset-option" data-preset="chatgpt">
          <i class="fas fa-comment"></i> ChatGPT Optimized
        </div>
      </div>
    </div>

    <!-- OUTPUT CARD -->
    <div class="card">
      <div class="section-title"><i class="fas fa-code"></i> Generated Prompt</div>
      <textarea id="output" class="output" readonly placeholder="Your formatted prompt will appear here..."></textarea>
      
      <div class="stats">
        <span id="charCount">0 characters</span> • 
        <span id="wordCount">0 words</span> • 
        <span id="lineCount">0 lines</span>
      </div>

      <div style="height:12px"></div>
      <div class="row">
        <button class="btn small copy" id="copyBtn"><i class="fas fa-copy"></i> Copy</button>
        <div class="tooltip">
          <button class="btn small chatgpt" id="chatgptBtn"><i class="fas fa-paper-plane"></i> ChatGPT</button>
          <span class="tooltiptext">Opens ChatGPT with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small claude" id="claudeBtn"><i class="fas fa-paper-plane"></i> Claude</button>
          <span class="tooltiptext">Opens Claude with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small gemini" id="geminiBtn"><i class="fas fa-paper-plane"></i> Gemini</button>
          <span class="tooltiptext">Opens Gemini with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small perplexity" id="perplexityBtn"><i class="fas fa-paper-plane"></i> Perplexity</button>
          <span class="tooltiptext">Opens Perplexity with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small deepseek" id="deepseekBtn"><i class="fas fa-paper-plane"></i> DeepSeek</button>
          <span class="tooltiptext">Opens DeepSeek with prompt ready to paste</span>
        </div>
        <button class="btn small export" id="exportBtn"><i class="fas fa-download"></i> Export</button>
        <button class="btn small history" id="toggleHistoryBtn"><i class="fas fa-history"></i> History</button>
        <button class="btn small templates" id="saveAsTemplateBtn"><i class="fas fa-save"></i> Save as Template</button>
      </div>
      
      <div class="history-panel" id="historyPanel">
        <div style="font-size:13px;margin-bottom:8px;color:var(--muted)">Recent prompts (click to reuse):</div>
        <div id="historyList"></div>
      </div>
    </div>

    <!-- HOW TO USE -->
    <div class="card">
      <div class="section-title"><i class="fas fa-info-circle"></i> How to Use</div>
      <ol class="howto">
        <li><b>Browse templates</b> or type your requirement</li>
        <li><b>Auto-converts</b> after 60 seconds (or click Convert)</li>
        <li><b>Click any AI button</b> - prompt auto-copies and tool opens</li>
        <li><b>Save successful prompts</b> as templates for reuse</li>
      </ol>
      <div class="footer">
        Uses fine-tuned AI model for optimal prompts • v2.2 • <span id="usageCount">0 prompts generated</span>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION -->
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Copied to clipboard!</span>
  </div>

  <!-- TEMPLATE MODAL -->
  <div class="template-modal" id="templateModal">
    <div class="template-modal-content">
      <div class="template-modal-header">
        <h3 style="margin:0" id="modalTitle">New Template</h3>
        <button class="close-modal" id="closeModalBtn">&times;</button>
      </div>
      <div class="template-modal-body">
        <div class="form-group">
          <label class="form-label">Template Name</label>
          <input type="text" id="templateName" class="form-input" placeholder="e.g., Professional Email Template">
        </div>
        
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="templateDescription" class="form-input" rows="3" placeholder="Describe what this template is for..."></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Prompt Content</label>
          <textarea id="templateContent" class="form-input" rows="6" placeholder="Paste your prompt template here..."></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Category</label>
          <select id="templateCategory" class="form-input">
            <option value="communication">Communication</option>
            <option value="coding">Coding</option>
            <option value="writing">Writing</option>
            <option value="analysis">Analysis</option>
            <option value="business">Business</option>
            <option value="creative">Creative</option>
            <option value="education">Education</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Tags (comma separated)</label>
          <input type="text" id="templateTags" class="form-input" placeholder="email, professional, team">
          <div id="tagsPreview" style="margin-top:8px"></div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Example Usage</label>
          <textarea id="templateExample" class="form-input" rows="3" placeholder="Show how to use this template..."></textarea>
        </div>
        
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px">
          <button class="btn small" id="cancelTemplateBtn" style="background:#6b7280">Cancel</button>
          <button class="btn small" id="saveTemplateBtn" style="background:#4f46e5">Save Template</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PASTE HELPER POPUP -->
  <div id="pasteHelper" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:30px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:2000; max-width:400px; width:90%;">
    <div style="text-align:center;">
      <i class="fas fa-clipboard-check" style="font-size:48px; color:#10b981; margin-bottom:15px;"></i>
      <h3 style="margin:0 0 10px;">Prompt Ready!</h3>
      <p style="color:#666; margin-bottom:20px; line-height:1.5;">Your prompt has been copied to clipboard.</p>
      <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:20px; text-align:left;">
        <div style="font-size:13px; color:#666; margin-bottom:5px;">Next steps:</div>
        <ol style="margin:0; padding-left:20px; font-size:14px;">
          <li>Go to the opened AI tool tab</li>
          <li>Click in the input box</li>
          <li>Press <strong>Ctrl+V</strong> (or Cmd+V on Mac)</li>
          <li>Press <strong>Enter</strong> to submit</li>
        </ol>
      </div>
      <div style="display:flex; gap:10px; justify-content:center;">
        <button id="closeHelper" style="padding:10px 20px; background:#4f46e5; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600;">Got it!</button>
        <button id="copyAgainBtn" style="padding:10px 20px; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:8px; cursor:pointer;">Copy Again</button>
      </div>
    </div>
  </div>
  <div id="overlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1999;"></div>

  <script>
    const OPENAI_API_URL = "https://api.openai.com/v1/chat/completions";
    const OPENAI_MODEL = "ft:gpt-3.5-turbo-1106:personal::CkAjxivm";
    
    // Global variables
    let currentPreset = 'default';
    let autoConvertEnabled = true;
    let debounceTimer;
    let usageCount = 0;
    let lastConvertedText = '';
    let isConverted = false;
    let autoConvertTimer;
    let autoConvertCountdown = 60;
    let countdownInterval;
    let editingTemplateId = null;

    // Template categories with icons and colors
    const TEMPLATE_CATEGORIES = {
      'communication': { name: 'Communication', icon: 'fa-envelope', color: '#3b82f6' },
      'coding': { name: 'Coding', icon: 'fa-code', color: '#10b981' },
      'writing': { name: 'Writing', icon: 'fa-pen', color: '#8b5cf6' },
      'analysis': { name: 'Analysis', icon: 'fa-chart-bar', color: '#f59e0b' },
      'business': { name: 'Business', icon: 'fa-briefcase', color: '#ef4444' },
      'creative': { name: 'Creative', icon: 'fa-palette', color: '#ec4899' },
      'education': { name: 'Education', icon: 'fa-graduation-cap', color: '#06b6d4' },
      'other': { name: 'Other', icon: 'fa-th', color: '#6b7280' }
    };

    // Default templates
    const DEFAULT_TEMPLATES = [
      {
        id: '1',
        name: 'Professional Email',
        description: 'Write clear, professional emails for business communication',
        category: 'communication',
        tags: ['email', 'professional', 'business'],
        content: `# Role
You are an expert business communicator skilled in writing professional emails.

# Objective
Write a professional email about [TOPIC] to [RECIPIENT]

# Context
- Recipient: [DESCRIBE RECIPIENT]
- Relationship: [DESCRIBE RELATIONSHIP]
- Purpose: [EMAIL PURPOSE]

# Instructions
1. Use professional but friendly tone
2. Start with appropriate greeting
3. State purpose clearly in first paragraph
4. Provide necessary details
5. Include clear call to action
6. End with professional closing

# Notes
- Keep it concise (150-200 words)
- Use proper email formatting
- Include subject line
- Check for tone appropriateness`,
        example: 'Write a professional email to my manager requesting a meeting to discuss project timeline adjustments.',
        usageCount: 0,
        createdAt: Date.now() - 86400000, // 1 day ago
        isDefault: true
      },
      {
        id: '2',
        name: 'Code Review Request',
        description: 'Request code reviews from team members effectively',
        category: 'coding',
        tags: ['code', 'review', 'team'],
        content: `# Role
You are an experienced software developer who needs code review.

# Objective
Request code review for [FEATURE/BUG_FIX] from [TEAM_MEMBER/TEAM]

# Context
- PR/MR Link: [LINK]
- Changes: [BRIEF_DESCRIPTION]
- Testing: [WHAT_WAS_TESTED]

# Instructions
1. Mention specific files/lines to review
2. Explain the change briefly
3. Mention any concerns or trade-offs
4. Specify what kind of feedback you need
5. Provide context if needed

# Notes
- Be specific about what to review
- Mention deadlines if any
- Thank the reviewer in advance`,
        example: 'Request code review for the new user authentication system from the backend team.',
        usageCount: 0,
        createdAt: Date.now() - 172800000, // 2 days ago
        isDefault: true
      },
      {
        id: '3',
        name: 'Meeting Agenda',
        description: 'Create structured meeting agendas for productive discussions',
        category: 'business',
        tags: ['meeting', 'agenda', 'productivity'],
        content: `# Role
You are an efficient meeting organizer.

# Objective
Create a meeting agenda for [MEETING_TOPIC] with [PARTICIPANTS]

# Context
- Date/Time: [DATETIME]
- Duration: [DURATION]
- Location: [LOCATION/PLATFORM]
- Participants: [LIST]

# Instructions
1. Meeting objective/goal
2. Topics to discuss (with time allocation)
3. Preparation required
4. Expected outcomes
5. Action items tracking

# Notes
- Allocate time for each topic
- Include breaks if long meeting
- Send agenda in advance
- Assign action items clearly`,
        example: 'Create a 1-hour team meeting agenda to discuss Q2 project planning with 5 team members.',
        usageCount: 0,
        createdAt: Date.now() - 259200000, // 3 days ago
        isDefault: true
      }
    ];

    // Load saved data
    const apiKeyInput = document.getElementById('apiKey');
    const savedKey = localStorage.getItem('OPENAI_API_KEY');
    if (savedKey) apiKeyInput.value = savedKey;
    
    // Load usage count
    const savedUsage = localStorage.getItem('promptCrafterUsage');
    if (savedUsage) {
      usageCount = parseInt(savedUsage);
      document.getElementById('usageCount').textContent = `${usageCount} prompts generated`;
    }

    // Initialize templates
    function initializeTemplates() {
      let templates = JSON.parse(localStorage.getItem('promptTemplates') || '[]');
      
      // Add default templates if none exist
      if (templates.length === 0) {
        templates = DEFAULT_TEMPLATES;
        localStorage.setItem('promptTemplates', JSON.stringify(templates));
      }
      
      return templates;
    }

    // Load templates
    let templates = initializeTemplates();

    // PRESET TEMPLATES
    const PRESETS = {
      'default': (role, requirement) => `# Role
You are an ${role} skilled in performing the task described.

# Objective
${requirement}

# Context
(Add relevant background information or constraints here)

# Instructions
1. Understand the requirement deeply
2. Break the problem into logical parts
3. Maintain accuracy and professionalism
4. Provide the final answer directly

# Notes
- Do not rewrite or restate the task
- Do not generate explanations about what you are going to do
- Do not generate another set of instructions
- Respond only with the completed output`,
      
      'claude': (role, requirement) => `Human: You are an ${role}. Please perform the following task directly without any preamble or explanation.

Task: ${requirement}

Context: Provide any relevant background or constraints.

Instructions:
1. Understand the task completely
2. Execute it precisely
3. Deliver the final result

Important: Do not rewrite the task. Do not explain your process. Just perform it and provide the output.

Assistant: I'll perform this task directly.`,
      
      'chatgpt': (role, requirement) => `System: You are an ${role}. The user will give you a task. Perform it directly without any meta-commentary.

User: ${requirement}

System reminder: 
- Perform the task exactly as requested
- No explanations or rewrites
- Output only the completed result
- Maintain professional quality`
    };

    // Initialize
    document.getElementById('saveKeyBtn').addEventListener('click', () => {
      localStorage.setItem('OPENAI_API_KEY', apiKeyInput.value.trim());
      showNotification('API key saved locally');
    });

    const requirementEl = document.getElementById('requirement');
    const outputEl = document.getElementById('output');
    const convertBtn = document.getElementById('convertBtn');
    const convertedBadge = document.getElementById('convertedBadge');
    const timerDisplay = document.getElementById('timerDisplay');
    const timerValue = document.getElementById('timerValue');

    // Function to get appropriate role
    function getAppropriateRole(text) {
      const lowerText = text.toLowerCase();
      if (/email|mail|send.*to|message.*to/i.test(lowerText)) return "expert email writer";
      if (/write|create|draft|compose|content|blog|article/i.test(lowerText)) return "expert content writer";
      if (/analyze|evaluate|review|assess|research|market/i.test(lowerText)) return "expert analyst";
      if (/code|program|script|develop|software|function|python|javascript/i.test(lowerText)) return "expert developer";
      if (/design|ui|ux|layout|graphic|visual|wireframe/i.test(lowerText)) return "expert designer";
      if (/business|strategy|plan|proposal|marketing|sales/i.test(lowerText)) return "expert business consultant";
      if (/translate|language|localize|interpret/i.test(lowerText)) return "expert translator";
      if (/math|calculate|solve|equation|formula|statistics/i.test(lowerText)) return "expert mathematician";
      if (/teach|explain|educate|tutor|lesson|guide/i.test(lowerText)) return "expert educator";
      if (/recipe|cook|food|meal|ingredient/i.test(lowerText)) return "expert chef";
      if (/workout|exercise|fitness|gym|train/i.test(lowerText)) return "expert fitness trainer";
      return "expert assistant";
    }

    // Update stats
    function updateStats(text) {
      const charCount = text.length;
      const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
      const lineCount = text.split('\n').length;
      
      document.getElementById('charCount').textContent = `${charCount} characters`;
      document.getElementById('wordCount').textContent = `${wordCount} words`;
      document.getElementById('lineCount').textContent = `${lineCount} lines`;
    }

    // Local formatter
    function localFormatter(raw) {
      const clean = (raw || '').trim() || '[No requirement provided]';
      const role = getAppropriateRole(clean);
      
      const template = PRESETS[currentPreset];
      return template ? template(role, clean) : PRESETS['default'](role, clean);
    }

    // Reset auto-convert timer
    function resetAutoConvertTimer() {
      clearTimeout(autoConvertTimer);
      clearInterval(countdownInterval);
      
      if (autoConvertEnabled && requirementEl.value.trim() && !isConverted) {
        autoConvertCountdown = 60;
        timerValue.textContent = `${autoConvertCountdown}s`;
        timerDisplay.style.display = 'inline-flex';
        
        countdownInterval = setInterval(() => {
          autoConvertCountdown--;
          timerValue.textContent = `${autoConvertCountdown}s`;
          
          if (autoConvertCountdown <= 0) {
            clearInterval(countdownInterval);
            timerDisplay.style.display = 'none';
            if (requirementEl.value.trim() && requirementEl.value.trim() !== lastConvertedText) {
              generatePrompt();
            }
          }
        }, 1000);
        
        autoConvertTimer = setTimeout(() => {
          if (requirementEl.value.trim() && requirementEl.value.trim() !== lastConvertedText) {
            generatePrompt();
          }
        }, 60000);
      }
    }

    // Auto-convert on typing
    requirementEl.addEventListener('input', () => {
      if (isConverted && requirementEl.value.trim() !== lastConvertedText) {
        isConverted = false;
        convertBtn.disabled = false;
        convertedBadge.style.display = 'none';
        timerDisplay.style.display = 'none';
        clearTimeout(autoConvertTimer);
        clearInterval(countdownInterval);
      }
      
      if (autoConvertEnabled) {
        resetAutoConvertTimer();
      }
      updateStats(requirementEl.value);
    });

    // Auto-convert toggle
    document.getElementById('autoConvert').addEventListener('change', (e) => {
      autoConvertEnabled = e.target.checked;
      if (!autoConvertEnabled) {
        clearTimeout(autoConvertTimer);
        clearInterval(countdownInterval);
        timerDisplay.style.display = 'none';
      } else if (requirementEl.value.trim() && !isConverted) {
        resetAutoConvertTimer();
      }
    });

    // Preset selection
    document.querySelectorAll('.preset-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.preset-option').forEach(o => o.classList.remove('active'));
        option.classList.add('active');
        currentPreset = option.dataset.preset;
        if (requirementEl.value.trim() && isConverted) {
          isConverted = false;
          generatePrompt();
        }
      });
    });

    // Examples
    document.querySelectorAll('.example-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        requirementEl.value = btn.dataset.example;
        requirementEl.focus();
        isConverted = false;
        convertBtn.disabled = false;
        convertedBadge.style.display = 'none';
        generatePrompt();
      });
    });

    // Generate prompt
    async function generatePrompt() {
      const raw = requirementEl.value.trim();
      if (!raw) {
        showNotification('Please enter a requirement first');
        return '';
      }

      // Track usage
      usageCount++;
      localStorage.setItem('promptCrafterUsage', usageCount);
      document.getElementById('usageCount').textContent = `${usageCount} prompts generated`;

      const apiKey = localStorage.getItem('OPENAI_API_KEY')?.trim();

      // Show converting state
      convertBtn.disabled = true;
      convertBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
      clearTimeout(autoConvertTimer);
      clearInterval(countdownInterval);
      timerDisplay.style.display = 'none';

      let text;
      
      try {
        if (!apiKey) {
          // Use local formatter
          text = localFormatter(raw);
        } else {
          // Use API
          const system = `You are a prompt generator. Convert the user's requirement into this EXACT format:
          
${PRESETS[currentPreset]('[ROLE]', '[REQUIREMENT]')}

Replace [ROLE] with appropriate role and [REQUIREMENT] with user's text.`;

          const userMessage = `Requirement: "${raw}"
          
Generate prompt in the ${currentPreset} format.`;

          const response = await fetch(OPENAI_API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": "Bearer " + apiKey
            },
            body: JSON.stringify({
              model: OPENAI_MODEL,
              messages: [
                { role: "system", content: system },
                { role: "user", content: userMessage }
              ],
              temperature: 0.1,
              max_tokens: 500
            })
          });

          if (response.ok) {
            const data = await response.json();
            text = data.choices?.[0]?.message?.content?.trim() || localFormatter(raw);
          } else {
            text = localFormatter(raw);
          }

          // Cleanup
          text = text.replace(/^```[^\n]*\n?/g, '');
          text = text.replace(/```$/g, '');
          text = text.trim();
        }

        outputEl.value = text;
        updateStats(text);
        saveToHistory(raw, text);
        
        // Update state
        isConverted = true;
        lastConvertedText = raw;
        convertBtn.disabled = true;
        convertedBadge.style.display = 'inline-flex';
        
        showNotification('Prompt generated successfully');
        
        // Reset auto-convert timer if text hasn't changed
        if (autoConvertEnabled) {
          resetAutoConvertTimer();
        }
        
        return text;

      } catch (err) {
        console.error(err);
        text = localFormatter(raw);
        outputEl.value = text;
        updateStats(text);
        saveToHistory(raw, text);
        showNotification('Generated with local template');
        
        // Still mark as converted
        isConverted = true;
        lastConvertedText = raw;
        convertBtn.disabled = true;
        convertedBadge.style.display = 'inline-flex';
        
        return text;
      } finally {
        convertBtn.disabled = true;
        convertBtn.innerHTML = '<i class="fas fa-magic"></i> Convert to Prompt';
      }
    }

    // Save to history
    function saveToHistory(requirement, prompt) {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const item = {
        id: Date.now(),
        requirement: requirement.substring(0, 100) + (requirement.length > 100 ? '...' : ''),
        prompt: prompt,
        timestamp: new Date().toLocaleTimeString(),
        date: new Date().toLocaleDateString(),
        fullRequirement: requirement
      };
      
      history.unshift(item);
      if (history.length > 10) history.pop();
      
      localStorage.setItem('promptHistory', JSON.stringify(history));
      localStorage.setItem(`fullReq_${item.id}`, requirement);
      loadHistory();
    }

    // Load history
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      
      history.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div>
            <div style="font-weight:500">${item.requirement}</div>
            <div style="font-size:11px;color:var(--muted)">${item.date} ${item.timestamp}</div>
          </div>
          <button class="btn small" style="padding:4px 8px;font-size:11px" onclick="event.stopPropagation();useHistoryItem('${item.id}')">Use</button>
        `;
        div.addEventListener('click', (e) => {
          if (!e.target.closest('button')) {
            requirementEl.value = localStorage.getItem(`fullReq_${item.id}`) || item.requirement;
            outputEl.value = item.prompt;
            updateStats(item.prompt);
            isConverted = true;
            lastConvertedText = requirementEl.value.trim();
            convertBtn.disabled = true;
            convertedBadge.style.display = 'inline-flex';
            showNotification('Prompt loaded from history');
          }
        });
        historyList.appendChild(div);
      });
    }

    // Use history item
    window.useHistoryItem = function(id) {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const item = history.find(h => h.id == id);
      if (item) {
        requirementEl.value = localStorage.getItem(`fullReq_${id}`) || item.requirement;
        generatePrompt();
      }
    };

    // Toggle history
    document.getElementById('toggleHistoryBtn').addEventListener('click', () => {
      const panel = document.getElementById('historyPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      if (panel.style.display === 'block') loadHistory();
    });

    // TEMPLATE LIBRARY FUNCTIONS

    // Load categories
    function loadCategories() {
      const categoriesContainer = document.getElementById('templateCategories');
      categoriesContainer.innerHTML = '';
      
      // Add "All" category
      const allCategory = document.createElement('div');
      allCategory.className = 'template-category active';
      allCategory.dataset.category = 'all';
      allCategory.innerHTML = '<i class="fas fa-th"></i> All';
      allCategory.addEventListener('click', () => filterTemplates('all'));
      categoriesContainer.appendChild(allCategory);
      
      // Add other categories
      Object.keys(TEMPLATE_CATEGORIES).forEach(categoryId => {
        const category = TEMPLATE_CATEGORIES[categoryId];
        const categoryEl = document.createElement('div');
        categoryEl.className = 'template-category';
        categoryEl.dataset.category = categoryId;
        categoryEl.innerHTML = `<i class="fas ${category.icon}"></i> ${category.name}`;
        categoryEl.addEventListener('click', () => filterTemplates(categoryId));
        categoriesContainer.appendChild(categoryEl);
      });
    }

    // Load templates
    function loadTemplates(filterCategory = 'all', searchQuery = '') {
      const templatesGrid = document.getElementById('templatesGrid');
      const emptyState = document.getElementById('emptyTemplates');
      
      templatesGrid.innerHTML = '';
      
      let filteredTemplates = templates;
      
      // Apply category filter
      if (filterCategory !== 'all') {
        filteredTemplates = filteredTemplates.filter(t => t.category === filterCategory);
      }
      
      // Apply search filter
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filteredTemplates = filteredTemplates.filter(t => 
          t.name.toLowerCase().includes(query) ||
          t.description.toLowerCase().includes(query) ||
          t.tags.some(tag => tag.toLowerCase().includes(query))
        );
      }
      
      // Show empty state if no templates
      if (filteredTemplates.length === 0) {
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      // Render templates
      filteredTemplates.forEach(template => {
        const category = TEMPLATE_CATEGORIES[template.category];
        const card = document.createElement('div');
        card.className = 'template-card';
        card.innerHTML = `
          <div class="template-icon" style="background:${category.color}">
            <i class="fas ${category.icon}"></i>
          </div>
          <div class="template-title">${template.name}</div>
          <div class="template-desc">${template.description}</div>
          <div class="template-meta">
            <span><i class="fas fa-tag"></i> ${template.tags.slice(0, 2).join(', ')}</span>
            <span><i class="fas fa-download"></i> ${template.usageCount}</span>
          </div>
          <div class="template-actions">
            <button class="btn small" style="background:${category.color}" onclick="useTemplate('${template.id}')">
              <i class="fas fa-play"></i> Use
            </button>
            <button class="btn small" style="background:#6b7280" onclick="editTemplate('${template.id}')">
              <i class="fas fa-edit"></i>
            </button>
            ${!template.isDefault ? `<button class="btn small" style="background:#ef4444" onclick="deleteTemplate('${template.id}')">
              <i class="fas fa-trash"></i>
            </button>` : ''}
          </div>
        `;
        templatesGrid.appendChild(card);
      });
    }

    // Filter templates
    function filterTemplates(category) {
      // Update active category
      document.querySelectorAll('.template-category').forEach(cat => {
        cat.classList.remove('active');
      });
      document.querySelector(`.template-category[data-category="${category}"]`).classList.add('active');
      
      const searchQuery = document.getElementById('templateSearch').value;
      loadTemplates(category, searchQuery);
    }

    // Use template
    window.useTemplate = function(templateId) {
      const template = templates.find(t => t.id === templateId);
      if (template) {
        // Update usage count
        template.usageCount = (template.usageCount || 0) + 1;
        saveTemplates();
        
        // Fill requirement with example
        requirementEl.value = template.example || '';
        
        // Generate prompt from template content
        outputEl.value = template.content;
        updateStats(template.content);
        
        // Update state
        isConverted = true;
        lastConvertedText = requirementEl.value.trim();
        convertBtn.disabled = true;
        convertedBadge.style.display = 'inline-flex';
        
        showNotification(`Using "${template.name}" template`);
      }
    };

    // Edit template
    window.editTemplate = function(templateId) {
      const template = templates.find(t => t.id === templateId);
      if (template) {
        editingTemplateId = templateId;
        document.getElementById('modalTitle').textContent = 'Edit Template';
        document.getElementById('templateName').value = template.name;
        document.getElementById('templateDescription').value = template.description;
        document.getElementById('templateContent').value = template.content;
        document.getElementById('templateCategory').value = template.category;
        document.getElementById('templateTags').value = template.tags.join(', ');
        document.getElementById('templateExample').value = template.example || '';
        
        // Update tags preview
        updateTagsPreview(template.tags);
        
        // Show modal
        document.getElementById('templateModal').style.display = 'flex';
      }
    };

    // Delete template
    window.deleteTemplate = function(templateId) {
      if (confirm('Are you sure you want to delete this template?')) {
        templates = templates.filter(t => t.id !== templateId && t.isDefault);
        saveTemplates();
        loadTemplates();
        showNotification('Template deleted');
      }
    };

    // Save templates
    function saveTemplates() {
      localStorage.setItem('promptTemplates', JSON.stringify(templates));
    }

    // New template
    document.getElementById('newTemplateBtn').addEventListener('click', () => {
      editingTemplateId = null;
      document.getElementById('modalTitle').textContent = 'New Template';
      document.getElementById('templateName').value = '';
      document.getElementById('templateDescription').value = '';
      document.getElementById('templateContent').value = outputEl.value || '';
      document.getElementById('templateCategory').value = 'communication';
      document.getElementById('templateTags').value = '';
      document.getElementById('templateExample').value = requirementEl.value || '';
      document.getElementById('tagsPreview').innerHTML = '';
      
      document.getElementById('templateModal').style.display = 'flex';
    });

    // Save as template from output
    document.getElementById('saveAsTemplateBtn').addEventListener('click', () => {
      if (!outputEl.value.trim()) {
        showNotification('Generate a prompt first before saving as template');
        return;
      }
      
      editingTemplateId = null;
      document.getElementById('modalTitle').textContent = 'Save as Template';
      document.getElementById('templateName').value = `Prompt ${new Date().toLocaleDateString()}`;
      document.getElementById('templateDescription').value = 'Custom prompt template';
      document.getElementById('templateContent').value = outputEl.value;
      document.getElementById('templateCategory').value = 'other';
      document.getElementById('templateTags').value = 'custom';
      document.getElementById('templateExample').value = requirementEl.value || '';
      document.getElementById('tagsPreview').innerHTML = '<span class="tag">custom</span>';
      
      document.getElementById('templateModal').style.display = 'flex';
    });

    // Update tags preview
    function updateTagsPreview(tags) {
      const tagsPreview = document.getElementById('tagsPreview');
      tagsPreview.innerHTML = '';
      tags.forEach(tag => {
        const tagEl = document.createElement('span');
        tagEl.className = 'tag';
        tagEl.innerHTML = `<i class="fas fa-tag"></i> ${tag}`;
        tagsPreview.appendChild(tagEl);
      });
    }

    // Template tags input
    document.getElementById('templateTags').addEventListener('input', function() {
      const tags = this.value.split(',').map(tag => tag.trim()).filter(tag => tag);
      updateTagsPreview(tags);
    });

    // Save template
    document.getElementById('saveTemplateBtn').addEventListener('click', () => {
      const name = document.getElementById('templateName').value.trim();
      const description = document.getElementById('templateDescription').value.trim();
      const content = document.getElementById('templateContent').value.trim();
      const category = document.getElementById('templateCategory').value;
      const tags = document.getElementById('templateTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
      const example = document.getElementById('templateExample').value.trim();
      
      if (!name || !content) {
        showNotification('Name and content are required');
        return;
      }
      
      if (editingTemplateId) {
        // Update existing template
        const index = templates.findIndex(t => t.id === editingTemplateId);
        if (index !== -1) {
          templates[index] = {
            ...templates[index],
            name,
            description,
            content,
            category,
            tags,
            example
          };
        }
      } else {
        // Add new template
        const newTemplate = {
          id: Date.now().toString(),
          name,
          description,
          content,
          category,
          tags,
          example,
          usageCount: 0,
          createdAt: Date.now(),
          isDefault: false
        };
        templates.push(newTemplate);
      }
      
      saveTemplates();
      loadTemplates();
      document.getElementById('templateModal').style.display = 'none';
      showNotification(`Template "${name}" saved`);
    });

    // Close template modal
    document.getElementById('closeModalBtn').addEventListener('click', () => {
      document.getElementById('templateModal').style.display = 'none';
    });

    document.getElementById('cancelTemplateBtn').addEventListener('click', () => {
      document.getElementById('templateModal').style.display = 'none';
    });

    // Toggle templates panel
    document.getElementById('toggleTemplatesBtn').addEventListener('click', () => {
      const panel = document.getElementById('templatesPanel');
      const btn = document.getElementById('toggleTemplatesBtn');
      
      if (panel.style.display === 'none') {
        panel.style.display = 'block';
        btn.innerHTML = '<i class="fas fa-eye-slash"></i> Hide';
        loadCategories();
        loadTemplates();
      } else {
        panel.style.display = 'none';
        btn.innerHTML = '<i class="fas fa-eye"></i> Show';
      }
    });

    // Template search
    document.getElementById('templateSearch').addEventListener('input', function() {
      const activeCategory = document.querySelector('.template-category.active').dataset.category;
      loadTemplates(activeCategory, this.value);
    });

    // Notification
    function showNotification(message) {
      const notification = document.getElementById('notification');
      document.getElementById('notificationText').textContent = message;
      notification.style.display = 'flex';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Show paste helper
    function showPasteHelper(platform) {
      const helper = document.getElementById('pasteHelper');
      const overlay = document.getElementById('overlay');
      const title = helper.querySelector('h3');
      title.textContent = `Prompt Ready for ${platform}!`;
      helper.style.display = 'block';
      overlay.style.display = 'block';
    }

    // Close paste helper
    document.getElementById('closeHelper').addEventListener('click', () => {
      document.getElementById('pasteHelper').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    });

    // Copy again button
    document.getElementById('copyAgainBtn').addEventListener('click', async () => {
      await copyToClipboard();
      showNotification('Prompt copied again!');
    });

    // Copy to clipboard
    async function copyToClipboard() {
      if (!outputEl.value) {
        showNotification('No prompt to copy. Generate one first.');
        return false;
      }
      
      try {
        await navigator.clipboard.writeText(outputEl.value);
        return true;
      } catch (err) {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = outputEl.value;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          document.body.removeChild(textArea);
          return true;
        } catch (err2) {
          document.body.removeChild(textArea);
          showNotification('Failed to copy. Please copy manually.');
          return false;
        }
      }
    }

    // AI Tools with improved auto-paste
    function createAIToolHandler(url, platform) {
      return async function() {
        if (!outputEl.value || !isConverted) {
          await generatePrompt();
        }
        
        const copied = await copyToClipboard();
        if (!copied) return;
        
        showPasteHelper(platform);
        
        try {
          window.open(url, '_blank');
        } catch (err) {
          showNotification(`${platform} blocked by popup blocker. Please allow popups.`);
        }
      };
    }

    // Export function
    document.getElementById('exportBtn').addEventListener('click', async () => {
      if (!outputEl.value) await generatePrompt();
      
      const blob = new Blob([outputEl.value], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `prompt-${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Prompt exported as .txt file');
    });

    // Event listeners
    document.getElementById("convertBtn").addEventListener("click", generatePrompt);
    document.getElementById("copyBtn").addEventListener("click", async () => {
      if (!outputEl.value) await generatePrompt();
      await copyToClipboard();
      showNotification('Prompt copied to clipboard!');
    });

    // AI Tools handlers
    document.getElementById("claudeBtn").addEventListener("click", 
      createAIToolHandler("https://claude.ai/new", "Claude"));
    
    document.getElementById("chatgptBtn").addEventListener("click", 
      createAIToolHandler("https://chat.openai.com/", "ChatGPT"));
    
    document.getElementById("geminiBtn").addEventListener("click", 
      createAIToolHandler("https://gemini.google.com/app", "Gemini"));
    
    document.getElementById("perplexityBtn").addEventListener("click", 
      createAIToolHandler("https://www.perplexity.ai/", "Perplexity"));
    
    document.getElementById("deepseekBtn").addEventListener("click", 
      createAIToolHandler("https://chat.deepseek.com/", "DeepSeek"));

    // Initialize
    loadHistory();
    updateStats('');
    
    // Focus on input
    requirementEl.focus();

    // Browser compatibility check
    if (!navigator.clipboard) {
      showNotification('Clipboard API not supported. Using fallback method.');
    }
  </script>
</body>
</html>
