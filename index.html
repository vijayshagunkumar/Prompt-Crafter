<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prompt Crafter Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --brand: #4f46e5;
      --brand-2: #22c55e;
      --brand-3: #0284c7;
      --brand-4: #7c3aed;
      --brand-5: #f97316;
      --brand-6: #10b981;
      --ring: rgba(79, 70, 229, .15);
      --border: #e2e8f0;
      --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.1);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      overflow-x: hidden;
    }
    
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      line-height: 1.5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 0;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .logo {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: var(--gradient-1);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 22px;
      font-family: 'Poppins', sans-serif;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }
    
    .logo::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
    }
    
    .logo:hover::after {
      animation: shine 1.5s ease infinite;
    }
    
    @keyframes shine {
      100% { transform: translateX(100%); }
    }
    
    .logo-text {
      display: flex;
      flex-direction: column;
    }
    
    h1 {
      font-size: 28px;
      font-weight: 800;
      margin: 0;
      background: var(--gradient-1);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'Poppins', sans-serif;
      letter-spacing: -0.5px;
    }
    
    .subtitle {
      color: var(--muted);
      font-size: 14px;
      margin-top: 4px;
    }
    
    /* Settings */
    .settings-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 16px;
      cursor: pointer;
      color: var(--text);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
      background: white;
    }
    
    .settings-btn:hover {
      border-color: var(--brand);
      background: #f8fafc;
      transform: translateY(-1px);
    }
    
    .settings-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .settings-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: var(--shadow-lg);
    }
    
    .settings-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .settings-body {
      padding: 24px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
    }
    
    .form-input:focus {
      border-color: var(--brand);
      outline: none;
      box-shadow: 0 0 0 3px var(--ring);
    }
    
    .form-hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }
    
    .form-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }
    
    /* Main Layout */
    .main-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    @media (min-width: 1024px) {
      .main-content {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    /* Cards */
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      padding: 24px;
      margin-bottom: 0;
    }
    
    .section-title {
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 18px;
    }
    
    .section-title i {
      color: var(--brand);
      margin-right: 8px;
    }
    
    /* Input Area */
    textarea, .output {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      color: var(--text);
      padding: 16px;
      font-size: 15px;
      outline: none;
      resize: vertical;
      min-height: 150px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      line-height: 1.6;
      transition: border-color 0.2s;
    }
    
    textarea:focus, .output:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px var(--ring);
    }
    
    /* Buttons */
    .btn {
      user-select: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      border-radius: 12px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      color: #fff;
      transition: all 0.2s;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
    }
    
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn.convert {
      background: var(--brand);
      width: 100%;
      margin: 16px 0;
      padding: 14px 20px;
      font-size: 16px;
    }
    
    .btn.convert:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }
    
    .btn.small {
      padding: 10px 16px;
      font-size: 14px;
      border-radius: 10px;
    }
    
    .btn.copy { background: #1e293b; }
    .btn.claude { background: #111827; }
    .btn.chatgpt { background: var(--brand-3); }
    .btn.gemini { background: var(--brand-4); }
    .btn.perplexity { background: var(--brand-5); }
    .btn.deepseek { background: var(--brand-6); }
    .btn.export { background: var(--brand-2); }
    .btn.history { background: #64748b; }
    .btn.templates { background: #8b5cf6; }
    
    /* Quick Examples */
    .examples {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 12px 0;
    }
    
    .example-btn {
      background: #f1f5f9;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 16px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text);
    }
    
    .example-btn:hover {
      background: #e2e8f0;
      border-color: var(--brand);
    }
    
    /* Preset Selector */
    .preset-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 12px 0;
    }
    
    .preset-option {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: #f1f5f9;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    
    .preset-option.active {
      background: var(--brand);
      color: white;
    }
    
    .preset-option:hover:not(.active) {
      background: #e2e8f0;
    }
    
    /* Stats */
    .stats {
      font-size: 13px;
      color: var(--muted);
      margin-top: 12px;
      display: flex;
      gap: 16px;
    }
    
    /* Auto-convert */
    .auto-convert {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 12px 0;
      font-size: 14px;
    }
    
    .auto-convert input {
      width: 18px;
      height: 18px;
      accent-color: var(--brand);
    }
    
    /* Converted Badge */
    .converted-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #dcfce7;
      color: #166534;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      margin-left: 12px;
    }
    
    /* Timer */
    .timer-display {
      font-size: 12px;
      color: var(--muted);
      margin-left: 12px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--brand-2);
      color: white;
      padding: 14px 20px;
      border-radius: 12px;
      box-shadow: var(--shadow-lg);
      display: none;
      align-items: center;
      gap: 10px;
      z-index: 2000;
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    /* Template Library */
    .template-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .template-category {
      background: #f1f5f9;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .template-category.active {
      background: var(--brand);
      color: white;
    }
    
    .templates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .template-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s;
      height: 100%;
    }
    
    .template-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--brand);
    }
    
    .template-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      color: white;
      font-size: 20px;
    }
    
    .template-title {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 16px;
      color: var(--text);
    }
    
    .template-desc {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 16px;
      line-height: 1.5;
    }
    
    .template-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      font-size: 12px;
      color: var(--muted);
    }
    
    .template-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }
    
    /* Search */
    .search-box {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 10px;
      margin-bottom: 16px;
      font-size: 14px;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    
    /* History */
    .history-panel {
      display: none;
      margin-top: 20px;
      border-top: 1px solid var(--border);
      padding-top: 20px;
    }
    
    .history-item {
      background: #f8fafc;
      padding: 12px 16px;
      margin-bottom: 8px;
      border-radius: 10px;
      border-left: 4px solid var(--brand);
      cursor: pointer;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }
    
    .history-item:hover {
      background: #f1f5f9;
    }
    
    /* Footer */
    .footer {
      color: var(--muted);
      font-size: 13px;
      margin: 30px 0;
      text-align: center;
      padding: 20px 0;
      border-top: 1px solid var(--border);
    }
    
    /* Modal Close Button */
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.2s;
    }
    
    .close-modal:hover {
      background: #f1f5f9;
      color: var(--text);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 0 16px;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .logo {
        width: 42px;
        height: 42px;
        font-size: 20px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      .card {
        padding: 20px;
      }
      
      .btn-row {
        justify-content: center;
      }
      
      .btn.small {
        flex: 1;
        min-width: 140px;
      }
      
      .templates-grid {
        grid-template-columns: 1fr;
      }
      
      .section-title {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
      
      .section-title > div:last-child {
        align-self: stretch;
      }
    }
    
    @media (max-width: 480px) {
      .header {
        gap: 12px;
      }
      
      .section-title {
        font-size: 16px;
      }
      
      .btn.small {
        min-width: 120px;
        padding: 10px 12px;
        font-size: 13px;
      }
      
      .btn-row {
        gap: 8px;
      }
      
      .preset-selector {
        flex-direction: column;
      }
      
      .preset-option {
        justify-content: center;
      }
      
      .examples {
        flex-direction: column;
      }
      
      .example-btn {
        text-align: center;
      }
    }
    
    @media (min-width: 1440px) {
      .container {
        max-width: 1400px;
      }
    }
    
    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
    
    /* Loading Animation */
    .spinner {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* AI Tool Icons */
    .ai-icon {
      font-size: 12px;
      margin-right: 4px;
    }
    
    /* Tag styling */
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #f1f5f9;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo-container">
        <div class="logo">PCP</div>
        <div class="logo-text">
          <h1>Prompt Crafter Pro</h1>
          <div class="subtitle">Transform ideas into structured prompts · Created by Vijay Kumar</div>
        </div>
      </div>
      
      <button class="settings-btn" id="settingsBtn">
        <i class="fas fa-cog"></i> Settings
      </button>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
      <div class="settings-content">
        <div class="settings-header">
          <h2 style="margin: 0">Settings</h2>
          <button class="close-modal" id="closeSettingsBtn">&times;</button>
        </div>
        <div class="settings-body">
          <div class="form-group">
            <label class="form-label" for="apiKeyInput">
              <i class="fas fa-key"></i> OpenAI API Key (Optional)
            </label>
            <input type="password" id="apiKeyInput" class="form-input" placeholder="sk-...">
            <div class="form-hint">
              Your API key is stored locally in your browser and never sent to our servers.
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="autoConvertDelay">
              <i class="fas fa-clock"></i> Auto-convert Delay (Seconds)
            </label>
            <input type="range" id="autoConvertDelay" class="form-input" min="10" max="120" value="60">
            <div class="form-hint" id="delayValue">Current: 60 seconds</div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="themeSelect">
              <i class="fas fa-palette"></i> Theme
            </label>
            <select id="themeSelect" class="form-input">
              <option value="light">Light</option>
              <option value="dark">Dark (Coming Soon)</option>
              <option value="auto">Auto (System)</option>
            </select>
          </div>
          
          <div class="form-actions">
            <button class="btn" id="saveSettingsBtn" style="background: var(--brand)">
              <i class="fas fa-save"></i> Save Settings
            </button>
            <button class="btn" id="clearDataBtn" style="background: #64748b">
              <i class="fas fa-trash"></i> Clear All Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Left Column -->
      <div>
        <!-- Template Library -->
        <div class="card">
          <div class="section-title">
            <div><i class="fas fa-layer-group"></i> Template Library</div>
            <div>
              <button class="btn small templates" id="newTemplateBtn">
                <i class="fas fa-plus"></i> New
              </button>
              <button class="btn small templates" id="toggleTemplatesBtn">
                <i class="fas fa-eye"></i> Show
              </button>
            </div>
          </div>
          
          <div id="templatesPanel" style="display:none">
            <input type="text" id="templateSearch" class="search-box" placeholder="Search templates...">
            
            <div class="template-categories" id="templateCategories">
              <!-- Categories populated by JS -->
            </div>
            
            <div class="templates-grid" id="templatesGrid">
              <!-- Templates populated by JS -->
            </div>
            
            <div id="emptyTemplates" class="empty-state" style="display:none">
              <i class="fas fa-inbox" style="font-size:48px;margin-bottom:12px;opacity:0.5"></i>
              <p>No templates found. Create your first template!</p>
            </div>
          </div>
        </div>

        <!-- Quick Examples -->
        <div class="card">
          <div class="section-title"><i class="fas fa-bolt"></i> Quick Examples</div>
          <div class="examples">
            <button class="example-btn" data-example="Write a professional email to my team about the deadline extension">Email</button>
            <button class="example-btn" data-example="Create a Python function to calculate Fibonacci sequence">Code</button>
            <button class="example-btn" data-example="Analyze the market trends for electric vehicles in 2024">Analysis</button>
            <button class="example-btn" data-example="Write a blog post about the benefits of meditation">Blog Post</button>
            <button class="example-btn" data-example="Design a workout plan for beginners">Workout Plan</button>
          </div>
        </div>

        <!-- Input Area -->
        <div class="card">
          <div class="section-title">
            <i class="fas fa-edit"></i> Your Requirement
            <span id="convertedBadge" class="converted-badge" style="display:none">
              <i class="fas fa-check-circle"></i> Converted
            </span>
            <span id="timerDisplay" class="timer-display" style="display:none">
              <i class="fas fa-clock"></i> <span id="timerValue">60s</span>
            </span>
          </div>
          
          <div class="auto-convert">
            <input type="checkbox" id="autoConvert" checked>
            <label for="autoConvert">Auto-convert as I type</label>
          </div>
          
          <textarea id="requirement" placeholder="Type your requirement here..."></textarea>
          <button id="convertBtn" class="btn convert">
            <i class="fas fa-magic"></i> Convert to Prompt
          </button>
        </div>

        <!-- Preset Selector -->
        <div class="card">
          <div class="section-title"><i class="fas fa-sliders-h"></i> Prompt Style</div>
          <div class="preset-selector">
            <div class="preset-option active" data-preset="default">
              <i class="fas fa-check-circle"></i> Standard
            </div>
            <div class="preset-option" data-preset="claude">
              <i class="fas fa-robot"></i> Claude
            </div>
            <div class="preset-option" data-preset="chatgpt">
              <i class="fas fa-comment"></i> ChatGPT
            </div>
            <div class="preset-option" data-preset="detailed">
              <i class="fas fa-list-alt"></i> Detailed
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div>
        <!-- Output Area -->
        <div class="card" style="height: calc(100% - 20px); display: flex; flex-direction: column;">
          <div class="section-title"><i class="fas fa-code"></i> Generated Prompt</div>
          <textarea id="output" class="output" readonly placeholder="Your formatted prompt will appear here..." style="flex: 1;"></textarea>
          
          <div class="stats">
            <span id="charCount">0 characters</span>
            <span id="wordCount">0 words</span>
            <span id="lineCount">0 lines</span>
          </div>

          <div class="btn-row">
            <button class="btn small copy" id="copyBtn">
              <i class="fas fa-copy"></i> Copy
            </button>
            <button class="btn small chatgpt" id="chatgptBtn">
              <i class="fas fa-paper-plane"></i> ChatGPT
            </button>
            <button class="btn small claude" id="claudeBtn">
              <i class="fas fa-paper-plane"></i> Claude
            </button>
            <button class="btn small gemini" id="geminiBtn">
              <i class="fas fa-paper-plane"></i> Gemini
            </button>
          </div>
          
          <div class="btn-row">
            <button class="btn small perplexity" id="perplexityBtn">
              <i class="fas fa-paper-plane"></i> Perplexity
            </button>
            <button class="btn small deepseek" id="deepseekBtn">
              <i class="fas fa-paper-plane"></i> DeepSeek
            </button>
            <button class="btn small export" id="exportBtn">
              <i class="fas fa-download"></i> Export
            </button>
            <button class="btn small history" id="toggleHistoryBtn">
              <i class="fas fa-history"></i> History
            </button>
            <button class="btn small templates" id="saveAsTemplateBtn">
              <i class="fas fa-save"></i> Save Template
            </button>
          </div>
          
          <div class="history-panel" id="historyPanel">
            <div style="font-size:13px;margin-bottom:12px;color:var(--muted); display: flex; justify-content: space-between; align-items: center;">
              <span>Recent prompts:</span>
              <button class="btn small" id="clearHistoryBtn" style="padding: 4px 12px; font-size: 12px; background: #ef4444;">
                <i class="fas fa-trash"></i> Clear
              </button>
            </div>
            <div id="historyList"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div>Uses fine-tuned AI model for optimal prompts • v3.0 • <span id="usageCount">0 prompts generated</span></div>
      <div style="margin-top: 8px; font-size: 12px;">
        <i class="fas fa-shield-alt"></i> Your data stays in your browser • 
        <i class="fas fa-code"></i> Open Source
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Copied to clipboard!</span>
  </div>

  <!-- Template Modal -->
  <div class="settings-modal" id="templateModal">
    <div class="settings-content">
      <div class="settings-header">
        <h2 style="margin: 0" id="modalTitle">New Template</h2>
        <button class="close-modal" id="closeTemplateBtn">&times;</button>
      </div>
      <div class="settings-body">
        <div class="form-group">
          <label class="form-label">Template Name</label>
          <input type="text" id="templateName" class="form-input" placeholder="e.g., Professional Email Template">
        </div>
        
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="templateDescription" class="form-input" rows="2" placeholder="Describe what this template is for..."></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Prompt Content</label>
          <textarea id="templateContent" class="form-input" rows="6" placeholder="Paste your prompt template here..."></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Category</label>
          <select id="templateCategory" class="form-input">
            <option value="communication">Communication</option>
            <option value="coding">Coding</option>
            <option value="writing">Writing</option>
            <option value="analysis">Analysis</option>
            <option value="business">Business</option>
            <option value="creative">Creative</option>
            <option value="education">Education</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Example Usage</label>
          <textarea id="templateExample" class="form-input" rows="3" placeholder="Show an example of how to use this template..."></textarea>
        </div>
        
        <div class="form-actions">
          <button class="btn" id="cancelTemplateBtn" style="background: #64748b">
            Cancel
          </button>
          <button class="btn" id="saveTemplateBtn" style="background: var(--brand)">
            Save Template
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Application State
    const OPENAI_API_URL = "https://api.openai.com/v1/chat/completions";
    const OPENAI_MODEL = "ft:gpt-3.5-turbo-1106:personal::CkAjxivm";
    
    let currentPreset = 'default';
    let autoConvertEnabled = true;
    let autoConvertDelay = 60;
    let usageCount = 0;
    let lastConvertedText = '';
    let isConverted = false;
    let autoConvertTimer;
    let autoConvertCountdown = 60;
    let countdownInterval;
    let editingTemplateId = null;
    let templates = [];

    // Template categories
    const TEMPLATE_CATEGORIES = {
      'communication': { name: 'Communication', icon: 'fa-envelope', color: '#3b82f6' },
      'coding': { name: 'Coding', icon: 'fa-code', color: '#10b981' },
      'writing': { name: 'Writing', icon: 'fa-pen', color: '#8b5cf6' },
      'analysis': { name: 'Analysis', icon: 'fa-chart-bar', color: '#f59e0b' },
      'business': { name: 'Business', icon: 'fa-briefcase', color: '#ef4444' },
      'creative': { name: 'Creative', icon: 'fa-palette', color: '#ec4899' },
      'education': { name: 'Education', icon: 'fa-graduation-cap', color: '#06b6d4' },
      'other': { name: 'Other', icon: 'fa-th', color: '#6b7280' }
    };

    // Default templates
    const DEFAULT_TEMPLATES = [
      {
        id: '1',
        name: 'Professional Email',
        description: 'Write clear, professional emails for business communication',
        category: 'communication',
        tags: ['email', 'professional', 'business'],
        content: `# Role
You are an expert business communicator skilled in writing professional emails.

# Objective
Write a professional email about [TOPIC] to [RECIPIENT]

# Context
- Recipient: [DESCRIBE RECIPIENT]
- Relationship: [DESCRIBE RELATIONSHIP]
- Purpose: [EMAIL PURPOSE]

# Instructions
1. Use professional but friendly tone
2. Start with appropriate greeting
3. State purpose clearly in first paragraph
4. Provide necessary details
5. Include clear call to action
6. End with professional closing

# Notes
- Keep it concise (150-200 words)
- Use proper email formatting
- Include subject line
- Check for tone appropriateness`,
        example: 'Write a professional email to my manager requesting a meeting to discuss project timeline adjustments.',
        usageCount: 5,
        createdAt: Date.now() - 86400000,
        isDefault: true
      },
      {
        id: '2',
        name: 'Code Review Request',
        description: 'Request code reviews from team members effectively',
        category: 'coding',
        tags: ['code', 'review', 'team'],
        content: `# Role
You are an experienced software developer who needs code review.

# Objective
Request code review for [FEATURE/BUG_FIX] from [TEAM_MEMBER/TEAM]

# Context
- PR/MR Link: [LINK]
- Changes: [BRIEF_DESCRIPTION]
- Testing: [WHAT_WAS_TESTED]

# Instructions
1. Mention specific files/lines to review
2. Explain the change briefly
3. Mention any concerns or trade-offs
4. Specify what kind of feedback you need
5. Provide context if needed

# Notes
- Be specific about what to review
- Mention deadlines if any
- Thank the reviewer in advance`,
        example: 'Request code review for the new user authentication system from the backend team.',
        usageCount: 3,
        createdAt: Date.now() - 172800000,
        isDefault: true
      },
      {
        id: '3',
        name: 'Meeting Agenda',
        description: 'Create structured meeting agendas for productive discussions',
        category: 'business',
        tags: ['meeting', 'agenda', 'productivity'],
        content: `# Role
You are an efficient meeting organizer.

# Objective
Create a meeting agenda for [MEETING_TOPIC] with [PARTICIPANTS]

# Context
- Date/Time: [DATETIME]
- Duration: [DURATION]
- Location: [LOCATION/PLATFORM]
- Participants: [LIST]

# Instructions
1. Meeting objective/goal
2. Topics to discuss (with time allocation)
3. Preparation required
4. Expected outcomes
5. Action items tracking

# Notes
- Allocate time for each topic
- Include breaks if long meeting
- Send agenda in advance
- Assign action items clearly`,
        example: 'Create a 1-hour team meeting agenda to discuss Q2 project planning with 5 team members.',
        usageCount: 2,
        createdAt: Date.now() - 259200000,
        isDefault: true
      },
      {
        id: '4',
        name: 'Blog Post Outline',
        description: 'Create comprehensive blog post outlines',
        category: 'writing',
        tags: ['blog', 'writing', 'content'],
        content: `# Role
You are an experienced content strategist and blogger.

# Objective
Create an outline for a blog post about [TOPIC]

# Context
- Target Audience: [AUDIENCE]
- Tone: [FORMAL/CASUAL/TECHNICAL]
- Word Count: [NUMBER]
- Purpose: [INFORM/PERSUADE/ENTERTAIN]

# Instructions
1. Create a compelling title
2. Write an engaging introduction
3. Outline main sections with subheadings
4. Include key points for each section
5. Add call-to-action
6. Suggest relevant keywords

# Notes
- Ensure logical flow
- Include examples and data points
- Add internal/external links
- Consider SEO best practices`,
        example: 'Create a blog post outline about the benefits of remote work for tech companies.',
        usageCount: 4,
        createdAt: Date.now() - 345600000,
        isDefault: true
      }
    ];

    // Preset templates
    const PRESETS = {
      'default': (role, requirement) => `# Role
You are an ${role} skilled in performing the task described.

# Objective
${requirement}

# Context
(Add relevant background information or constraints here)

# Instructions
1. Understand the requirement deeply
2. Break the problem into logical parts
3. Maintain accuracy and professionalism
4. Provide the final answer directly

# Notes
- Do not rewrite or restate the task
- Do not generate explanations about what you are going to do
- Do not generate another set of instructions
- Respond only with the completed output`,
      
      'claude': (role, requirement) => `Human: You are an ${role}. Please perform the following task directly without any preamble or explanation.

Task: ${requirement}

Context: Provide any relevant background or constraints.

Instructions:
1. Understand the task completely
2. Execute it precisely
3. Deliver the final result

Important: Do not rewrite the task. Do not explain your process. Just perform it and provide the output.

Assistant: I'll perform this task directly.`,
      
      'chatgpt': (role, requirement) => `System: You are an ${role}. The user will give you a task. Perform it directly without any meta-commentary.

User: ${requirement}

System reminder: 
- Perform the task exactly as requested
- No explanations or rewrites
- Output only the completed result
- Maintain professional quality`,
      
      'detailed': (role, requirement) => `# Expert Role Assignment
You are now assuming the role of: ${role}

# Primary Task Objective
${requirement}

# Operational Context & Constraints
- Timeframe: [SPECIFY IF RELEVANT]
- Resources: [MENTION AVAILABLE RESOURCES]
- Constraints: [LIST ANY LIMITATIONS]
- Quality Standards: [SPECIFY EXPECTED QUALITY]

# Detailed Step-by-Step Instructions
1. **Analysis Phase**: Analyze the requirement thoroughly
2. **Planning Phase**: Break down into logical components
3. **Execution Phase**: Implement each component systematically
4. **Quality Check**: Review for accuracy and completeness
5. **Final Delivery**: Present the final output appropriately

# Formatting Requirements
- Structure: [SPECIFY STRUCTURE IF NEEDED]
- Length: [MENTION DESIRED LENGTH]
- Style: [SPECIFY WRITING STYLE]
- Technical Level: [MENTION TECHNICAL DEPTH]

# Additional Notes
- Include examples where relevant
- Add explanations only if explicitly requested
- Maintain consistent formatting
- Ensure factual accuracy
- Consider practical applicability`
    };

    // Initialize Application
    document.addEventListener('DOMContentLoaded', () => {
      initializeApp();
    });

    function initializeApp() {
      // Load all data
      loadSettings();
      loadTemplates();
      loadUsageCount();
      
      // Setup event listeners
      setupEventListeners();
      
      // Initialize UI components
      initializeUI();
      
      // Focus on input
      document.getElementById('requirement').focus();
    }

    function loadSettings() {
      const apiKey = localStorage.getItem('OPENAI_API_KEY') || '';
      const delay = localStorage.getItem('autoConvertDelay') || '60';
      const theme = localStorage.getItem('theme') || 'light';
      
      document.getElementById('apiKeyInput').value = apiKey;
      document.getElementById('autoConvertDelay').value = delay;
      document.getElementById('themeSelect').value = theme;
      document.getElementById('delayValue').textContent = `Current: ${delay} seconds`;
      
      autoConvertDelay = parseInt(delay);
      autoConvertCountdown = autoConvertDelay;
    }

    function loadTemplates() {
      const savedTemplates = localStorage.getItem('promptTemplates');
      if (savedTemplates) {
        templates = JSON.parse(savedTemplates);
      } else {
        templates = DEFAULT_TEMPLATES;
        localStorage.setItem('promptTemplates', JSON.stringify(templates));
      }
    }

    function loadUsageCount() {
      const savedUsage = localStorage.getItem('promptCrafterUsage');
      if (savedUsage) {
        usageCount = parseInt(savedUsage);
        document.getElementById('usageCount').textContent = `${usageCount} prompts generated`;
      }
    }

    function setupEventListeners() {
      // Settings
      document.getElementById('settingsBtn').addEventListener('click', () => {
        document.getElementById('settingsModal').style.display = 'flex';
      });
      
      document.getElementById('closeSettingsBtn').addEventListener('click', () => {
        document.getElementById('settingsModal').style.display = 'none';
      });
      
      document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
      
      document.getElementById('clearDataBtn').addEventListener('click', () => {
        if (confirm('Are you sure you want to clear all data? This will delete all templates, history, and settings.')) {
          clearAllData();
        }
      });
      
      // Auto-convert delay slider
      const delaySlider = document.getElementById('autoConvertDelay');
      const delayValue = document.getElementById('delayValue');
      delaySlider.addEventListener('input', () => {
        delayValue.textContent = `Current: ${delaySlider.value} seconds`;
        autoConvertDelay = parseInt(delaySlider.value);
      });
      
      // Requirement input
      const requirementEl = document.getElementById('requirement');
      requirementEl.addEventListener('input', handleRequirementInput);
      
      // Auto-convert toggle
      document.getElementById('autoConvert').addEventListener('change', (e) => {
        autoConvertEnabled = e.target.checked;
        if (!autoConvertEnabled) {
          clearAutoConvertTimer();
        } else if (requirementEl.value.trim() && !isConverted) {
          resetAutoConvertTimer();
        }
      });
      
      // Preset selection
      document.querySelectorAll('.preset-option').forEach(option => {
        option.addEventListener('click', () => {
          document.querySelectorAll('.preset-option').forEach(o => o.classList.remove('active'));
          option.classList.add('active');
          currentPreset = option.dataset.preset;
          if (requirementEl.value.trim() && isConverted) {
            isConverted = false;
            generatePrompt();
          }
        });
      });
      
      // Examples
      document.querySelectorAll('.example-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          requirementEl.value = btn.dataset.example;
          requirementEl.focus();
          isConverted = false;
          document.getElementById('convertBtn').disabled = false;
          document.getElementById('convertedBadge').style.display = 'none';
          generatePrompt();
        });
      });
      
      // Convert button
      document.getElementById('convertBtn').addEventListener('click', generatePrompt);
      
      // Copy button
      document.getElementById('copyBtn').addEventListener('click', async () => {
        if (!document.getElementById('output').value) await generatePrompt();
        await copyToClipboard();
        showNotification('Prompt copied to clipboard!');
      });
      
      // AI Tools
      document.getElementById('chatgptBtn').addEventListener('click', () => openAITool('ChatGPT', 'https://chat.openai.com/'));
      document.getElementById('claudeBtn').addEventListener('click', () => openAITool('Claude', 'https://claude.ai/new'));
      document.getElementById('geminiBtn').addEventListener('click', () => openAITool('Gemini', 'https://gemini.google.com/app'));
      document.getElementById('perplexityBtn').addEventListener('click', () => openAITool('Perplexity', 'https://www.perplexity.ai/'));
      document.getElementById('deepseekBtn').addEventListener('click', () => openAITool('DeepSeek', 'https://chat.deepseek.com/'));
      
      // Export
      document.getElementById('exportBtn').addEventListener('click', exportPrompt);
      
      // History
      document.getElementById('toggleHistoryBtn').addEventListener('click', toggleHistory);
      document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
      
      // Template functionality
      setupTemplateListeners();
    }

    function initializeUI() {
      updateStats('');
      loadHistory();
    }

    // Core Functions
    function handleRequirementInput() {
      const requirementEl = document.getElementById('requirement');
      const convertBtn = document.getElementById('convertBtn');
      
      if (isConverted && requirementEl.value.trim() !== lastConvertedText) {
        isConverted = false;
        convertBtn.disabled = false;
        document.getElementById('convertedBadge').style.display = 'none';
        document.getElementById('timerDisplay').style.display = 'none';
        clearAutoConvertTimer();
      }
      
      if (autoConvertEnabled) {
        resetAutoConvertTimer();
      }
      updateStats(requirementEl.value);
    }

    function resetAutoConvertTimer() {
      clearAutoConvertTimer();
      
      const requirement = document.getElementById('requirement').value.trim();
      if (autoConvertEnabled && requirement && !isConverted) {
        autoConvertCountdown = autoConvertDelay;
        document.getElementById('timerValue').textContent = `${autoConvertCountdown}s`;
        document.getElementById('timerDisplay').style.display = 'inline-flex';
        
        countdownInterval = setInterval(() => {
          autoConvertCountdown--;
          document.getElementById('timerValue').textContent = `${autoConvertCountdown}s`;
          
          if (autoConvertCountdown <= 0) {
            clearInterval(countdownInterval);
            document.getElementById('timerDisplay').style.display = 'none';
            if (requirement && requirement !== lastConvertedText) {
              generatePrompt();
            }
          }
        }, 1000);
        
        autoConvertTimer = setTimeout(() => {
          const currentRequirement = document.getElementById('requirement').value.trim();
          if (currentRequirement && currentRequirement !== lastConvertedText) {
            generatePrompt();
          }
        }, autoConvertDelay * 1000);
      }
    }

    function clearAutoConvertTimer() {
      clearTimeout(autoConvertTimer);
      clearInterval(countdownInterval);
      document.getElementById('timerDisplay').style.display = 'none';
    }

    function getAppropriateRole(text) {
      const lowerText = text.toLowerCase();
      if (/email|mail|send.*to|message.*to/i.test(lowerText)) return "expert email writer";
      if (/write|create|draft|compose|content|blog|article/i.test(lowerText)) return "expert content writer";
      if (/analyze|evaluate|review|assess|research|market/i.test(lowerText)) return "expert analyst";
      if (/code|program|script|develop|software|function|python|javascript/i.test(lowerText)) return "expert developer";
      if (/design|ui|ux|layout|graphic|visual|wireframe/i.test(lowerText)) return "expert designer";
      if (/business|strategy|plan|proposal|marketing|sales/i.test(lowerText)) return "expert business consultant";
      if (/translate|language|localize|interpret/i.test(lowerText)) return "expert translator";
      if (/math|calculate|solve|equation|formula|statistics/i.test(lowerText)) return "expert mathematician";
      if (/teach|explain|educate|tutor|lesson|guide/i.test(lowerText)) return "expert educator";
      if (/recipe|cook|food|meal|ingredient/i.test(lowerText)) return "expert chef";
      if (/workout|exercise|fitness|gym|train/i.test(lowerText)) return "expert fitness trainer";
      return "expert assistant";
    }

    function updateStats(text) {
      const charCount = text.length;
      const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
      const lineCount = text.split('\n').length;
      
      document.getElementById('charCount').textContent = `${charCount} characters`;
      document.getElementById('wordCount').textContent = `${wordCount} words`;
      document.getElementById('lineCount').textContent = `${lineCount} lines`;
    }

    async function generatePrompt() {
      const requirementEl = document.getElementById('requirement');
      const outputEl = document.getElementById('output');
      const convertBtn = document.getElementById('convertBtn');
      const raw = requirementEl.value.trim();
      
      if (!raw) {
        showNotification('Please enter a requirement first');
        return '';
      }

      // Track usage
      usageCount++;
      localStorage.setItem('promptCrafterUsage', usageCount);
      document.getElementById('usageCount').textContent = `${usageCount} prompts generated`;

      const apiKey = localStorage.getItem('OPENAI_API_KEY')?.trim();

      // Show converting state
      convertBtn.disabled = true;
      convertBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
      clearAutoConvertTimer();

      let generatedPrompt;
      
      try {
        if (!apiKey) {
          // Use local formatter
          generatedPrompt = localFormatter(raw);
        } else {
          // Use API
          const role = getAppropriateRole(raw);
          const system = `You are a prompt generator. Convert the user's requirement into this EXACT format:
          
${PRESETS[currentPreset]('[ROLE]', '[REQUIREMENT]')}

Replace [ROLE] with appropriate role and [REQUIREMENT] with user's text.`;

          const userMessage = `Requirement: "${raw}"
          
Generate prompt in the ${currentPreset} format.`;

          const response = await fetch(OPENAI_API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": "Bearer " + apiKey
            },
            body: JSON.stringify({
              model: OPENAI_MODEL,
              messages: [
                { role: "system", content: system },
                { role: "user", content: userMessage }
              ],
              temperature: 0.1,
              max_tokens: 500
            })
          });

          if (response.ok) {
            const data = await response.json();
            generatedPrompt = data.choices?.[0]?.message?.content?.trim() || localFormatter(raw);
          } else {
            generatedPrompt = localFormatter(raw);
          }

          // Cleanup
          generatedPrompt = generatedPrompt.replace(/^```[^\n]*\n?/g, '');
          generatedPrompt = generatedPrompt.replace(/```$/g, '');
          generatedPrompt = generatedPrompt.trim();
        }

        outputEl.value = generatedPrompt;
        updateStats(generatedPrompt);
        saveToHistory(raw, generatedPrompt);
        
        // Update state
        isConverted = true;
        lastConvertedText = raw;
        convertBtn.disabled = true;
        document.getElementById('convertedBadge').style.display = 'inline-flex';
        
        showNotification('Prompt generated successfully');
        
        // Reset auto-convert timer if text hasn't changed
        if (autoConvertEnabled) {
          resetAutoConvertTimer();
        }
        
        return generatedPrompt;

      } catch (err) {
        console.error('Generation error:', err);
        generatedPrompt = localFormatter(raw);
        outputEl.value = generatedPrompt;
        updateStats(generatedPrompt);
        saveToHistory(raw, generatedPrompt);
        showNotification('Generated with local template');
        
        // Still mark as converted
        isConverted = true;
        lastConvertedText = raw;
        convertBtn.disabled = true;
        document.getElementById('convertedBadge').style.display = 'inline-flex';
        
        return generatedPrompt;
      } finally {
        convertBtn.disabled = true;
        convertBtn.innerHTML = '<i class="fas fa-magic"></i> Convert to Prompt';
      }
    }

    function localFormatter(raw) {
      const clean = (raw || '').trim() || '[No requirement provided]';
      const role = getAppropriateRole(clean);
      
      const template = PRESETS[currentPreset];
      return template ? template(role, clean) : PRESETS['default'](role, clean);
    }

    async function copyToClipboard() {
      const outputEl = document.getElementById('output');
      if (!outputEl.value) {
        showNotification('No prompt to copy. Generate one first.');
        return false;
      }
      
      try {
        await navigator.clipboard.writeText(outputEl.value);
        return true;
      } catch (err) {
        // Fallback
        const textArea = document.createElement('textarea');
        textArea.value = outputEl.value;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          document.body.removeChild(textArea);
          return true;
        } catch (err2) {
          document.body.removeChild(textArea);
          showNotification('Failed to copy. Please copy manually.');
          return false;
        }
      }
    }

    async function openAITool(platform, url) {
      const outputEl = document.getElementById('output');
      if (!outputEl.value || !isConverted) {
        await generatePrompt();
      }
      
      const copied = await copyToClipboard();
      if (!copied) return;
      
      showNotification(`Prompt copied! Opening ${platform}...`);
      
      try {
        window.open(url, '_blank');
      } catch (err) {
        showNotification(`${platform} blocked by popup blocker. Please allow popups.`);
      }
    }

    function exportPrompt() {
      const outputEl = document.getElementById('output');
      if (!outputEl.value) {
        showNotification('Generate a prompt first');
        return;
      }
      
      const blob = new Blob([outputEl.value], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `prompt-${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Prompt exported as .txt file');
    }

    // Settings Functions
    function saveSettings() {
      const apiKey = document.getElementById('apiKeyInput').value.trim();
      const delay = document.getElementById('autoConvertDelay').value;
      const theme = document.getElementById('themeSelect').value;
      
      localStorage.setItem('OPENAI_API_KEY', apiKey);
      localStorage.setItem('autoConvertDelay', delay);
      localStorage.setItem('theme', theme);
      
      autoConvertDelay = parseInt(delay);
      autoConvertCountdown = autoConvertDelay;
      
      document.getElementById('settingsModal').style.display = 'none';
      showNotification('Settings saved successfully!');
    }

    function clearAllData() {
      localStorage.removeItem('promptTemplates');
      localStorage.removeItem('promptHistory');
      localStorage.removeItem('promptCrafterUsage');
      
      // Keep settings
      const apiKey = localStorage.getItem('OPENAI_API_KEY');
      const delay = localStorage.getItem('autoConvertDelay');
      const theme = localStorage.getItem('theme');
      
      localStorage.clear();
      
      if (apiKey) localStorage.setItem('OPENAI_API_KEY', apiKey);
      if (delay) localStorage.setItem('autoConvertDelay', delay);
      if (theme) localStorage.setItem('theme', theme);
      
      // Reset state
      usageCount = 0;
      templates = [...DEFAULT_TEMPLATES];
      isConverted = false;
      lastConvertedText = '';
      
      // Reset UI
      document.getElementById('requirement').value = '';
      document.getElementById('output').value = '';
      document.getElementById('usageCount').textContent = '0 prompts generated';
      document.getElementById('historyList').innerHTML = '';
      document.getElementById('templatesGrid').innerHTML = '';
      updateStats('');
      
      // Clear badges
      document.getElementById('convertedBadge').style.display = 'none';
      document.getElementById('timerDisplay').style.display = 'none';
      document.getElementById('convertBtn').disabled = false;
      
      // Save default templates
      localStorage.setItem('promptTemplates', JSON.stringify(templates));
      
      document.getElementById('settingsModal').style.display = 'none';
      showNotification('All data cleared successfully!');
    }

    // History Functions
    function saveToHistory(requirement, prompt) {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const item = {
        id: Date.now(),
        requirement: requirement.substring(0, 100) + (requirement.length > 100 ? '...' : ''),
        prompt: prompt,
        timestamp: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        date: new Date().toLocaleDateString(),
        fullRequirement: requirement
      };
      
      history.unshift(item);
      if (history.length > 15) history.pop();
      
      localStorage.setItem('promptHistory', JSON.stringify(history));
      localStorage.setItem(`fullReq_${item.id}`, requirement);
      loadHistory();
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      
      if (history.length === 0) {
        historyList.innerHTML = '<div style="text-align: center; color: var(--muted); padding: 20px; font-size: 13px;">No history yet</div>';
        return;
      }
      
      history.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div style="flex: 1; min-width: 0;">
            <div style="font-weight:500; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.requirement}</div>
            <div style="font-size:11px;color:var(--muted)">${item.date} ${item.timestamp}</div>
          </div>
          <button class="btn small" style="padding:6px 12px;font-size:12px; flex-shrink: 0;" onclick="event.stopPropagation();useHistoryItem('${item.id}')">Use</button>
        `;
        div.addEventListener('click', (e) => {
          if (!e.target.closest('button')) {
            const requirementEl = document.getElementById('requirement');
            const outputEl = document.getElementById('output');
            requirementEl.value = localStorage.getItem(`fullReq_${item.id}`) || item.requirement;
            outputEl.value = item.prompt;
            updateStats(item.prompt);
            isConverted = true;
            lastConvertedText = requirementEl.value.trim();
            document.getElementById('convertBtn').disabled = true;
            document.getElementById('convertedBadge').style.display = 'inline-flex';
            showNotification('Prompt loaded from history');
          }
        });
        historyList.appendChild(div);
      });
    }

    function toggleHistory() {
      const panel = document.getElementById('historyPanel');
      const isVisible = panel.style.display === 'block';
      panel.style.display = isVisible ? 'none' : 'block';
      if (!isVisible) loadHistory();
    }

    function clearHistory() {
      if (confirm('Are you sure you want to clear all history?')) {
        localStorage.removeItem('promptHistory');
        loadHistory();
        showNotification('History cleared');
      }
    }

    window.useHistoryItem = function(id) {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const item = history.find(h => h.id == id);
      if (item) {
        document.getElementById('requirement').value = localStorage.getItem(`fullReq_${id}`) || item.requirement;
        generatePrompt();
      }
    };

    // Template Functions
    function setupTemplateListeners() {
      // Toggle templates panel
      document.getElementById('toggleTemplatesBtn').addEventListener('click', () => {
        const panel = document.getElementById('templatesPanel');
        const btn = document.getElementById('toggleTemplatesBtn');
        
        if (panel.style.display === 'none') {
          panel.style.display = 'block';
          btn.innerHTML = '<i class="fas fa-eye-slash"></i> Hide';
          loadCategories();
          loadTemplatesToUI();
        } else {
          panel.style.display = 'none';
          btn.innerHTML = '<i class="fas fa-eye"></i> Show';
        }
      });
      
      // Template search
      document.getElementById('templateSearch').addEventListener('input', function() {
        const activeCategory = document.querySelector('.template-category.active')?.dataset.category || 'all';
        filterTemplatesUI(activeCategory, this.value);
      });
      
      // New template
      document.getElementById('newTemplateBtn').addEventListener('click', () => {
        editingTemplateId = null;
        document.getElementById('modalTitle').textContent = 'New Template';
        document.getElementById('templateName').value = '';
        document.getElementById('templateDescription').value = '';
        document.getElementById('templateContent').value = document.getElementById('output').value || '';
        document.getElementById('templateCategory').value = 'communication';
        document.getElementById('templateExample').value = document.getElementById('requirement').value || '';
        document.getElementById('templateModal').style.display = 'flex';
      });
      
      // Save as template
      document.getElementById('saveAsTemplateBtn').addEventListener('click', () => {
        if (!document.getElementById('output').value.trim()) {
          showNotification('Generate a prompt first before saving as template');
          return;
        }
        
        editingTemplateId = null;
        document.getElementById('modalTitle').textContent = 'Save as Template';
        document.getElementById('templateName').value = `Prompt ${new Date().toLocaleDateString()}`;
        document.getElementById('templateDescription').value = 'Custom prompt template';
        document.getElementById('templateContent').value = document.getElementById('output').value;
        document.getElementById('templateCategory').value = 'other';
        document.getElementById('templateExample').value = document.getElementById('requirement').value || '';
        document.getElementById('templateModal').style.display = 'flex';
      });
      
      // Save template
      document.getElementById('saveTemplateBtn').addEventListener('click', saveTemplate);
      
      // Close template modal
      document.getElementById('closeTemplateBtn').addEventListener('click', () => {
        document.getElementById('templateModal').style.display = 'none';
      });
      
      document.getElementById('cancelTemplateBtn').addEventListener('click', () => {
        document.getElementById('templateModal').style.display = 'none';
      });
    }

    function loadCategories() {
      const container = document.getElementById('templateCategories');
      container.innerHTML = '';
      
      // All category
      const allCat = document.createElement('div');
      allCat.className = 'template-category active';
      allCat.dataset.category = 'all';
      allCat.innerHTML = '<i class="fas fa-th"></i> All';
      allCat.addEventListener('click', () => filterTemplatesUI('all'));
      container.appendChild(allCat);
      
      // Other categories
      Object.keys(TEMPLATE_CATEGORIES).forEach(id => {
        const cat = TEMPLATE_CATEGORIES[id];
        const catEl = document.createElement('div');
        catEl.className = 'template-category';
        catEl.dataset.category = id;
        catEl.innerHTML = `<i class="fas ${cat.icon}"></i> ${cat.name}`;
        catEl.addEventListener('click', () => filterTemplatesUI(id));
        container.appendChild(catEl);
      });
    }

    function loadTemplatesToUI(filterCategory = 'all', searchQuery = '') {
      const grid = document.getElementById('templatesGrid');
      const empty = document.getElementById('emptyTemplates');
      
      grid.innerHTML = '';
      
      let filtered = templates;
      
      if (filterCategory !== 'all') {
        filtered = filtered.filter(t => t.category === filterCategory);
      }
      
      if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filtered = filtered.filter(t => 
          t.name.toLowerCase().includes(query) ||
          t.description.toLowerCase().includes(query) ||
          (t.tags && t.tags.some(tag => tag.toLowerCase().includes(query)))
        );
      }
      
      if (filtered.length === 0) {
        empty.style.display = 'block';
        return;
      }
      
      empty.style.display = 'none';
      
      filtered.forEach(template => {
        const category = TEMPLATE_CATEGORIES[template.category];
        const card = document.createElement('div');
        card.className = 'template-card';
        card.innerHTML = `
          <div class="template-icon" style="background:${category.color}">
            <i class="fas ${category.icon}"></i>
          </div>
          <div class="template-title">${template.name}</div>
          <div class="template-desc">${template.description}</div>
          <div class="template-meta">
            <span><i class="fas fa-download"></i> Used ${template.usageCount || 0} times</span>
            <span class="tag"><i class="fas fa-tag"></i> ${category.name}</span>
          </div>
          <div class="template-actions">
            <button class="btn small" style="background:${category.color}" onclick="useTemplate('${template.id}')">
              <i class="fas fa-play"></i> Use
            </button>
            <button class="btn small" style="background:#64748b" onclick="editTemplate('${template.id}')">
              <i class="fas fa-edit"></i>
            </button>
            ${!template.isDefault ? `<button class="btn small" style="background:#ef4444" onclick="deleteTemplate('${template.id}')">
              <i class="fas fa-trash"></i>
            </button>` : ''}
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function filterTemplatesUI(category, searchQuery = '') {
      document.querySelectorAll('.template-category').forEach(cat => {
        cat.classList.remove('active');
      });
      document.querySelector(`.template-category[data-category="${category}"]`).classList.add('active');
      
      const currentSearch = searchQuery || document.getElementById('templateSearch').value;
      loadTemplatesToUI(category, currentSearch);
    }

    window.useTemplate = function(id) {
      const template = templates.find(t => t.id === id);
      if (template) {
        // Update usage count
        template.usageCount = (template.usageCount || 0) + 1;
        localStorage.setItem('promptTemplates', JSON.stringify(templates));
        
        // Fill requirement with example
        document.getElementById('requirement').value = template.example || '';
        
        // Generate prompt from template content
        document.getElementById('output').value = template.content;
        updateStats(template.content);
        
        // Update state
        isConverted = true;
        lastConvertedText = document.getElementById('requirement').value.trim();
        document.getElementById('convertBtn').disabled = true;
        document.getElementById('convertedBadge').style.display = 'inline-flex';
        
        showNotification(`Using "${template.name}" template`);
      }
    };

    window.editTemplate = function(id) {
      const template = templates.find(t => t.id === id);
      if (template) {
        editingTemplateId = id;
        document.getElementById('modalTitle').textContent = 'Edit Template';
        document.getElementById('templateName').value = template.name;
        document.getElementById('templateDescription').value = template.description;
        document.getElementById('templateContent').value = template.content;
        document.getElementById('templateCategory').value = template.category;
        document.getElementById('templateExample').value = template.example || '';
        
        document.getElementById('templateModal').style.display = 'flex';
      }
    };

    window.deleteTemplate = function(id) {
      if (confirm('Are you sure you want to delete this template?')) {
        templates = templates.filter(t => t.id !== id || t.isDefault);
        localStorage.setItem('promptTemplates', JSON.stringify(templates));
        loadTemplatesToUI();
        showNotification('Template deleted');
      }
    };

    function saveTemplate() {
      const name = document.getElementById('templateName').value.trim();
      const description = document.getElementById('templateDescription').value.trim();
      const content = document.getElementById('templateContent').value.trim();
      const category = document.getElementById('templateCategory').value;
      const example = document.getElementById('templateExample').value.trim();
      
      if (!name || !content) {
        showNotification('Name and content are required');
        return;
      }
      
      if (editingTemplateId) {
        // Update existing template
        const index = templates.findIndex(t => t.id === editingTemplateId);
        if (index !== -1) {
          templates[index] = {
            ...templates[index],
            name,
            description,
            content,
            category,
            example
          };
        }
      } else {
        // Add new template
        const newTemplate = {
          id: Date.now().toString(),
          name,
          description,
          content,
          category,
          example,
          usageCount: 0,
          createdAt: Date.now(),
          isDefault: false
        };
        templates.push(newTemplate);
      }
      
      localStorage.setItem('promptTemplates', JSON.stringify(templates));
      loadTemplatesToUI();
      document.getElementById('templateModal').style.display = 'none';
      showNotification(`Template "${name}" saved`);
    }

    // Utility Functions
    function showNotification(message) {
      const notification = document.getElementById('notification');
      document.getElementById('notificationText').textContent = message;
      notification.style.display = 'flex';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Make functions globally available
    window.clearHistory = clearHistory;
    window.useTemplate = window.useTemplate || useTemplate;
    window.editTemplate = window.editTemplate || editTemplate;
    window.deleteTemplate = window.deleteTemplate || deleteTemplate;
    window.useHistoryItem = window.useHistoryItem || useHistoryItem;
  </script>
</body>
</html>
