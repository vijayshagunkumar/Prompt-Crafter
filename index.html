<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prompt Crafter Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg:#f4f6ff;
      --card:#ffffff;
      --text:#121826;
      --muted:#6b7280;
      --brand:#4f46e5;
      --brand-2:#22c55e;
      --brand-3:#0284c7;
      --brand-4:#7c3aed;
      --brand-5:#f97316;
      --brand-6:#10b981;
      --ring:rgba(79,70,229,.25);
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }
    .container{max-width:900px;margin:32px auto;padding:0 20px}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
    .logo{
      width:36px;height:36px;border-radius:10px;
      background: conic-gradient(from 180deg at 50% 50%, #06b6d4, #f59e0b, #ef4444, #06b6d4);
      display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:18px;
    }
    h1{font-size:28px;margin:0}
    .subtitle{color:var(--muted);font-size:14px;margin:6px 0 0}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;
      box-shadow:0 1px 1px rgba(0,0,0,.02), 0 6px 24px rgba(0,0,0,.04);
      padding:18px 18px;
      margin-bottom:16px;
    }
    .section-title{font-weight:600;margin:2px 0 10px;display:flex;align-items:center;gap:8px;}
    .section-title i{color:var(--brand)}
    textarea, .output{
      width:100%;border:1px solid var(--border);border-radius:12px;background:#fff;color:var(--text);
      padding:14px;font-size:14px;outline:none;resize:vertical;min-height:120px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    textarea:focus, .output:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
    .btn{
      user-select:none;display:inline-flex;align-items:center;justify-content:center;
      gap:8px;padding:12px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:600;color:#fff;
      transition:.18s transform ease, .18s opacity ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.convert{background:var(--brand);width:100%;margin:14px 0}
    .btn.convert:disabled{opacity:0.6;cursor:not-allowed;}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .btn.small{padding:10px 14px;font-size:14px;border-radius:10px}
    .btn.copy{background:#111827}
    .btn.claude{background:#111827}
    .btn.chatgpt{background:var(--brand-3)}
    .btn.gemini{background:var(--brand-4)}
    .btn.perplexity{background:var(--brand-5)}
    .btn.deepseek{background:var(--brand-6)}
    .btn.export{background:var(--brand-2)}
    .btn.history{background:#6b7280}
    .muted{color:var(--muted);font-size:12px;margin-top:10px}
    .howto li{margin:6px 0}
    .topbar{
      display:flex;justify-content:space-between;align-items:center;margin:10px 0 18px;
    }
    .api-box{display:flex;gap:8px;align-items:center;}
    .api-input{
      width:320px;max-width:60vw;
      border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:13px;outline:none;background:#fff;
    }
    .api-input:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
    .btn.save{background:#10b981}
    .footer{color:var(--muted);font-size:12px;margin:18px 0;text-align:center}
    
    /* New Styles */
    .examples{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .example-btn{
      background:#f3f4f6;border:1px solid var(--border);border-radius:8px;
      padding:6px 12px;font-size:12px;cursor:pointer;transition:all 0.2s;
    }
    .example-btn:hover{background:#e5e7eb}
    
    .preset-selector{margin:12px 0}
    .preset-option{
      display:inline-flex;align-items:center;gap:6px;margin-right:12px;
      padding:6px 12px;background:#f3f4f6;border-radius:8px;cursor:pointer;
      font-size:13px;
    }
    .preset-option.active{background:var(--brand);color:white}
    
    .history-panel{display:none;margin-top:12px;border-top:1px solid var(--border);padding-top:12px}
    .history-item{
      background:#f9fafb;padding:8px 12px;margin-bottom:6px;border-radius:8px;
      border-left:3px solid var(--brand);cursor:pointer;font-size:13px;
    }
    .history-item:hover{background:#f3f4f6}
    
    .tooltip{
      position:relative;display:inline-block;
    }
    .tooltip .tooltiptext{
      visibility:hidden;width:200px;background-color:#111827;color:#fff;
      text-align:center;border-radius:6px;padding:5px;position:absolute;
      z-index:1;bottom:125%;left:50%;margin-left:-100px;font-size:12px;
      opacity:0;transition:opacity 0.3s;
    }
    .tooltip:hover .tooltiptext{visibility:visible;opacity:1}
    
    .stats{font-size:12px;color:var(--muted);margin-top:8px}
    
    .auto-convert{display:flex;align-items:center;gap:8px;margin:10px 0;font-size:13px}
    .auto-convert input{width:16px;height:16px}
    
    .notification{
      position:fixed;bottom:20px;right:20px;background:var(--brand-2);color:white;
      padding:12px 16px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
      display:none;align-items:center;gap:8px;z-index:1000;
    }
    
    .converted-badge{
      display:inline-flex;align-items:center;gap:4px;
      background:#dcfce7;color:#166534;padding:4px 8px;border-radius:6px;
      font-size:12px;margin-left:8px;
    }
    
    .timer-display{
      font-size:11px;color:var(--muted);margin-left:8px;
      display:inline-flex;align-items:center;gap:2px;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="topbar">
      <div class="header">
        <div class="logo">PC</div>
        <div>
          <h1>Prompt Crafter Pro</h1>
          <div class="subtitle">Transform ideas into structured prompts · Created by Vijay Kumar</div>
        </div>
      </div>

      <div class="api-box">
        <input id="apiKey" class="api-input" type="password" placeholder="Optional: OpenAI API Key" />
        <button class="btn small save" id="saveKeyBtn">Save</button>
      </div>
    </div>

    <!-- QUICK EXAMPLES -->
    <div class="card">
      <div class="section-title"><i class="fas fa-bolt"></i> Quick Examples</div>
      <div class="examples">
        <button class="example-btn" data-example="Write a professional email to my team about the deadline extension">Email</button>
        <button class="example-btn" data-example="Create a Python function to calculate Fibonacci sequence">Code</button>
        <button class="example-btn" data-example="Analyze the market trends for electric vehicles in 2024">Analysis</button>
        <button class="example-btn" data-example="Write a blog post about the benefits of meditation">Blog Post</button>
        <button class="example-btn" data-example="Design a workout plan for beginners">Workout Plan</button>
      </div>
    </div>

    <!-- INPUT CARD -->
    <div class="card">
      <div class="section-title"><i class="fas fa-edit"></i> Your Requirement
        <span id="convertedBadge" class="converted-badge" style="display:none">
          <i class="fas fa-check-circle"></i> Converted
        </span>
        <span id="timerDisplay" class="timer-display" style="display:none">
          <i class="fas fa-clock"></i> <span id="timerValue">60s</span>
        </span>
      </div>
      
      <div class="auto-convert">
        <input type="checkbox" id="autoConvert" checked>
        <label for="autoConvert">Auto-convert as I type (60s delay)</label>
      </div>
      
      <textarea id="requirement" placeholder="Type your requirement here..."></textarea>
      <button id="convertBtn" class="btn convert"><i class="fas fa-magic"></i> Convert to Prompt</button>
    </div>

    <!-- PRESET SELECTOR -->
    <div class="card">
      <div class="section-title"><i class="fas fa-sliders-h"></i> Prompt Style</div>
      <div class="preset-selector">
        <div class="preset-option active" data-preset="default">
          <i class="fas fa-check-circle"></i> Standard
        </div>
        <div class="preset-option" data-preset="claude">
          <i class="fas fa-robot"></i> Claude Optimized
        </div>
        <div class="preset-option" data-preset="chatgpt">
          <i class="fas fa-comment"></i> ChatGPT Optimized
        </div>
      </div>
    </div>

    <!-- OUTPUT CARD -->
    <div class="card">
      <div class="section-title"><i class="fas fa-code"></i> Generated Prompt</div>
      <textarea id="output" class="output" readonly placeholder="Your formatted prompt will appear here..."></textarea>
      
      <div class="stats">
        <span id="charCount">0 characters</span> • 
        <span id="wordCount">0 words</span> • 
        <span id="lineCount">0 lines</span>
      </div>

      <div style="height:12px"></div>
      <div class="row">
        <button class="btn small copy" id="copyBtn"><i class="fas fa-copy"></i> Copy</button>
        <div class="tooltip">
          <button class="btn small chatgpt" id="chatgptBtn"><i class="fas fa-paper-plane"></i> ChatGPT</button>
          <span class="tooltiptext">Opens ChatGPT with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small claude" id="claudeBtn"><i class="fas fa-paper-plane"></i> Claude</button>
          <span class="tooltiptext">Opens Claude with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small gemini" id="geminiBtn"><i class="fas fa-paper-plane"></i> Gemini</button>
          <span class="tooltiptext">Opens Gemini with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small perplexity" id="perplexityBtn"><i class="fas fa-paper-plane"></i> Perplexity</button>
          <span class="tooltiptext">Opens Perplexity with prompt ready to paste</span>
        </div>
        <div class="tooltip">
          <button class="btn small deepseek" id="deepseekBtn"><i class="fas fa-paper-plane"></i> DeepSeek</button>
          <span class="tooltiptext">Opens DeepSeek with prompt ready to paste</span>
        </div>
        <button class="btn small export" id="exportBtn"><i class="fas fa-download"></i> Export</button>
        <button class="btn small history" id="toggleHistoryBtn"><i class="fas fa-history"></i> History</button>
      </div>
      
      <div class="history-panel" id="historyPanel">
        <div style="font-size:13px;margin-bottom:8px;color:var(--muted)">Recent prompts (click to reuse):</div>
        <div id="historyList"></div>
      </div>
    </div>

    <!-- HOW TO USE -->
    <div class="card">
      <div class="section-title"><i class="fas fa-info-circle"></i> How to Use</div>
      <ol class="howto">
        <li><b>Type</b> your requirement or click an example</li>
        <li><b>Auto-converts</b> after 60 seconds (or click Convert)</li>
        <li><b>Click any AI button</b> - prompt auto-copies and tool opens</li>
        <li><b>Paste (Ctrl+V)</b> in the AI tool and press Enter!</li>
      </ol>
      <div class="footer">
        Uses fine-tuned AI model for optimal prompts • v2.1 • <span id="usageCount">0 prompts generated</span>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION -->
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Copied to clipboard!</span>
  </div>

  <!-- CROSS-WINDOW COMMUNICATION POPUP -->
  <div id="pasteHelper" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:30px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:2000; max-width:400px; width:90%;">
    <div style="text-align:center;">
      <i class="fas fa-clipboard-check" style="font-size:48px; color:#10b981; margin-bottom:15px;"></i>
      <h3 style="margin:0 0 10px;">Prompt Ready!</h3>
      <p style="color:#666; margin-bottom:20px; line-height:1.5;">Your prompt has been copied to clipboard.</p>
      <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:20px; text-align:left;">
        <div style="font-size:13px; color:#666; margin-bottom:5px;">Next steps:</div>
        <ol style="margin:0; padding-left:20px; font-size:14px;">
          <li>Go to the opened AI tool tab</li>
          <li>Click in the input box</li>
          <li>Press <strong>Ctrl+V</strong> (or Cmd+V on Mac)</li>
          <li>Press <strong>Enter</strong> to submit</li>
        </ol>
      </div>
      <div style="display:flex; gap:10px; justify-content:center;">
        <button id="closeHelper" style="padding:10px 20px; background:#4f46e5; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600;">Got it!</button>
        <button id="copyAgainBtn" style="padding:10px 20px; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:8px; cursor:pointer;">Copy Again</button>
      </div>
    </div>
  </div>
  <div id="overlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1999;"></div>

  <script>
    const OPENAI_API_URL = "https://api.openai.com/v1/chat/completions";
    const OPENAI_MODEL = "ft:gpt-3.5-turbo-1106:personal::CkAjxivm";
    
    // Global variables
    let currentPreset = 'default';
    let autoConvertEnabled = true;
    let debounceTimer;
    let usageCount = 0;
    let lastConvertedText = '';
    let isConverted = false;
    let autoConvertTimer;
    let autoConvertCountdown = 60; // 60 seconds
    let countdownInterval;

    // Load saved data
    const apiKeyInput = document.getElementById('apiKey');
    const savedKey = localStorage.getItem('OPENAI_API_KEY');
    if (savedKey) apiKeyInput.value = savedKey;
    
    // Load usage count
    const savedUsage = localStorage.getItem('promptCrafterUsage');
    if (savedUsage) {
      usageCount = parseInt(savedUsage);
      document.getElementById('usageCount').textContent = `${usageCount} prompts generated`;
    }

    // PRESET TEMPLATES
    const PRESETS = {
      'default': (role, requirement) => `# Role
You are an ${role} skilled in performing the task described.

# Objective
${requirement}

# Context
(Add relevant background information or constraints here)

# Instructions
1. Understand the requirement deeply
2. Break the problem into logical parts
3. Maintain accuracy and professionalism
4. Provide the final answer directly

# Notes
- Do not rewrite or restate the task
- Do not generate explanations about what you are going to do
- Do not generate another set of instructions
- Respond only with the completed output`,
      
      'claude': (role, requirement) => `Human: You are an ${role}. Please perform the following task directly without any preamble or explanation.

Task: ${requirement}

Context: Provide any relevant background or constraints.

Instructions:
1. Understand the task completely
2. Execute it precisely
3. Deliver the final result

Important: Do not rewrite the task. Do not explain your process. Just perform it and provide the output.

Assistant: I'll perform this task directly.`,
      
      'chatgpt': (role, requirement) => `System: You are an ${role}. The user will give you a task. Perform it directly without any meta-commentary.

User: ${requirement}

System reminder: 
- Perform the task exactly as requested
- No explanations or rewrites
- Output only the completed result
- Maintain professional quality`
    };

    // Initialize
    document.getElementById('saveKeyBtn').addEventListener('click', () => {
      localStorage.setItem('OPENAI_API_KEY', apiKeyInput.value.trim());
      showNotification('API key saved locally');
    });

    const requirementEl = document.getElementById('requirement');
    const outputEl = document.getElementById('output');
    const convertBtn = document.getElementById('convertBtn');
    const convertedBadge = document.getElementById('convertedBadge');
    const timerDisplay = document.getElementById('timerDisplay');
    const timerValue = document.getElementById('timerValue');

    // Function to get appropriate role
    function getAppropriateRole(text) {
      const lowerText = text.toLowerCase();
      if (/email|mail|send.*to|message.*to/i.test(lowerText)) return "expert email writer";
      if (/write|create|draft|compose|content|blog|article/i.test(lowerText)) return "expert content writer";
      if (/analyze|evaluate|review|assess|research|market/i.test(lowerText)) return "expert analyst";
      if (/code|program|script|develop|software|function|python|javascript/i.test(lowerText)) return "expert developer";
      if (/design|ui|ux|layout|graphic|visual|wireframe/i.test(lowerText)) return "expert designer";
      if (/business|strategy|plan|proposal|marketing|sales/i.test(lowerText)) return "expert business consultant";
      if (/translate|language|localize|interpret/i.test(lowerText)) return "expert translator";
      if (/math|calculate|solve|equation|formula|statistics/i.test(lowerText)) return "expert mathematician";
      if (/teach|explain|educate|tutor|lesson|guide/i.test(lowerText)) return "expert educator";
      if (/recipe|cook|food|meal|ingredient/i.test(lowerText)) return "expert chef";
      if (/workout|exercise|fitness|gym|train/i.test(lowerText)) return "expert fitness trainer";
      return "expert assistant";
    }

    // Update stats
    function updateStats(text) {
      const charCount = text.length;
      const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
      const lineCount = text.split('\n').length;
      
      document.getElementById('charCount').textContent = `${charCount} characters`;
      document.getElementById('wordCount').textContent = `${wordCount} words`;
      document.getElementById('lineCount').textContent = `${lineCount} lines`;
    }

    // Local formatter
    function localFormatter(raw) {
      const clean = (raw || '').trim() || '[No requirement provided]';
      const role = getAppropriateRole(clean);
      
      const template = PRESETS[currentPreset];
      return template ? template(role, clean) : PRESETS['default'](role, clean);
    }

    // Reset auto-convert timer
    function resetAutoConvertTimer() {
      clearTimeout(autoConvertTimer);
      clearInterval(countdownInterval);
      
      if (autoConvertEnabled && requirementEl.value.trim() && !isConverted) {
        autoConvertCountdown = 60;
        timerValue.textContent = `${autoConvertCountdown}s`;
        timerDisplay.style.display = 'inline-flex';
        
        countdownInterval = setInterval(() => {
          autoConvertCountdown--;
          timerValue.textContent = `${autoConvertCountdown}s`;
          
          if (autoConvertCountdown <= 0) {
            clearInterval(countdownInterval);
            timerDisplay.style.display = 'none';
            if (requirementEl.value.trim() && requirementEl.value.trim() !== lastConvertedText) {
              generatePrompt();
            }
          }
        }, 1000);
        
        autoConvertTimer = setTimeout(() => {
          if (requirementEl.value.trim() && requirementEl.value.trim() !== lastConvertedText) {
            generatePrompt();
          }
        }, 60000); // 60 seconds
      }
    }

    // Auto-convert on typing
    requirementEl.addEventListener('input', () => {
      // If user changes text after conversion, enable convert button
      if (isConverted && requirementEl.value.trim() !== lastConvertedText) {
        isConverted = false;
        convertBtn.disabled = false;
        convertedBadge.style.display = 'none';
        timerDisplay.style.display = 'none';
        clearTimeout(autoConvertTimer);
        clearInterval(countdownInterval);
      }
      
      if (autoConvertEnabled) {
        resetAutoConvertTimer();
      }
      updateStats(requirementEl.value);
    });

    // Auto-convert toggle
    document.getElementById('autoConvert').addEventListener('change', (e) => {
      autoConvertEnabled = e.target.checked;
      if (!autoConvertEnabled) {
        clearTimeout(autoConvertTimer);
        clearInterval(countdownInterval);
        timerDisplay.style.display = 'none';
      } else if (requirementEl.value.trim() && !isConverted) {
        resetAutoConvertTimer();
      }
    });

    // Preset selection
    document.querySelectorAll('.preset-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.preset-option').forEach(o => o.classList.remove('active'));
        option.classList.add('active');
        currentPreset = option.dataset.preset;
        if (requirementEl.value.trim() && isConverted) {
          // Regenerate with new preset
          isConverted = false;
          generatePrompt();
        }
      });
    });

    // Examples
    document.querySelectorAll('.example-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        requirementEl.value = btn.dataset.example;
        requirementEl.focus();
        isConverted = false;
        convertBtn.disabled = false;
        convertedBadge.style.display = 'none';
        generatePrompt();
      });
    });

    // Generate prompt
    async function generatePrompt() {
      const raw = requirementEl.value.trim();
      if (!raw) {
        showNotification('Please enter a requirement first');
        return '';
      }

      // Track usage
      usageCount++;
      localStorage.setItem('promptCrafterUsage', usageCount);
      document.getElementById('usageCount').textContent = `${usageCount} prompts generated`;

      const apiKey = localStorage.getItem('OPENAI_API_KEY')?.trim();

      // Show converting state
      convertBtn.disabled = true;
      convertBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
      clearTimeout(autoConvertTimer);
      clearInterval(countdownInterval);
      timerDisplay.style.display = 'none';

      let text;
      
      try {
        if (!apiKey) {
          // Use local formatter
          text = localFormatter(raw);
        } else {
          // Use API
          const system = `You are a prompt generator. Convert the user's requirement into this EXACT format:
          
${PRESETS[currentPreset]('[ROLE]', '[REQUIREMENT]')}

Replace [ROLE] with appropriate role and [REQUIREMENT] with user's text.`;

          const userMessage = `Requirement: "${raw}"
          
Generate prompt in the ${currentPreset} format.`;

          const response = await fetch(OPENAI_API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": "Bearer " + apiKey
            },
            body: JSON.stringify({
              model: OPENAI_MODEL,
              messages: [
                { role: "system", content: system },
                { role: "user", content: userMessage }
              ],
              temperature: 0.1,
              max_tokens: 500
            })
          });

          if (response.ok) {
            const data = await response.json();
            text = data.choices?.[0]?.message?.content?.trim() || localFormatter(raw);
          } else {
            text = localFormatter(raw);
          }

          // Cleanup
          text = text.replace(/^```[^\n]*\n?/g, '');
          text = text.replace(/```$/g, '');
          text = text.trim();
        }

        outputEl.value = text;
        updateStats(text);
        saveToHistory(raw, text);
        
        // Update state
        isConverted = true;
        lastConvertedText = raw;
        convertBtn.disabled = true;
        convertedBadge.style.display = 'inline-flex';
        
        showNotification('Prompt generated successfully');
        
        // Reset auto-convert timer if text hasn't changed
        if (autoConvertEnabled) {
          resetAutoConvertTimer();
        }
        
        return text;

      } catch (err) {
        console.error(err);
        text = localFormatter(raw);
        outputEl.value = text;
        updateStats(text);
        saveToHistory(raw, text);
        showNotification('Generated with local template');
        
        // Still mark as converted
        isConverted = true;
        lastConvertedText = raw;
        convertBtn.disabled = true;
        convertedBadge.style.display = 'inline-flex';
        
        return text;
      } finally {
        convertBtn.disabled = true;
        convertBtn.innerHTML = '<i class="fas fa-magic"></i> Convert to Prompt';
      }
    }

    // Save to history
    function saveToHistory(requirement, prompt) {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const item = {
        id: Date.now(),
        requirement: requirement.substring(0, 100) + (requirement.length > 100 ? '...' : ''),
        prompt: prompt,
        timestamp: new Date().toLocaleTimeString(),
        date: new Date().toLocaleDateString(),
        fullRequirement: requirement
      };
      
      history.unshift(item);
      if (history.length > 10) history.pop();
      
      localStorage.setItem('promptHistory', JSON.stringify(history));
      localStorage.setItem(`fullReq_${item.id}`, requirement);
      loadHistory();
    }

    // Load history
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('promptHistory') || '[]');
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      
      history.forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        div.innerHTML = `
          <div style="font-weight:500">${item.requirement}</div>
          <div style="font-size:11px;color:var(--muted)">${item.date} ${item.timestamp}</div>
        `;
        div.addEventListener('click', () => {
          requirementEl.value = localStorage.getItem(`fullReq_${item.id}`) || item.requirement;
          outputEl.value = item.prompt;
          updateStats(item.prompt);
          isConverted = true;
          lastConvertedText = requirementEl.value.trim();
          convertBtn.disabled = true;
          convertedBadge.style.display = 'inline-flex';
          showNotification('Prompt loaded from history');
        });
        historyList.appendChild(div);
      });
    }

    // Toggle history
    document.getElementById('toggleHistoryBtn').addEventListener('click', () => {
      const panel = document.getElementById('historyPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      if (panel.style.display === 'block') loadHistory();
    });

    // Notification
    function showNotification(message) {
      const notification = document.getElementById('notification');
      document.getElementById('notificationText').textContent = message;
      notification.style.display = 'flex';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Show paste helper
    function showPasteHelper(platform) {
      const helper = document.getElementById('pasteHelper');
      const overlay = document.getElementById('overlay');
      const title = helper.querySelector('h3');
      title.textContent = `Prompt Ready for ${platform}!`;
      helper.style.display = 'block';
      overlay.style.display = 'block';
    }

    // Close paste helper
    document.getElementById('closeHelper').addEventListener('click', () => {
      document.getElementById('pasteHelper').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    });

    // Copy again button
    document.getElementById('copyAgainBtn').addEventListener('click', async () => {
      await copyToClipboard();
      showNotification('Prompt copied again!');
    });

    // Copy to clipboard
    async function copyToClipboard() {
      if (!outputEl.value) {
        showNotification('No prompt to copy. Generate one first.');
        return false;
      }
      
      try {
        await navigator.clipboard.writeText(outputEl.value);
        return true;
      } catch (err) {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = outputEl.value;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          document.body.removeChild(textArea);
          return true;
        } catch (err2) {
          document.body.removeChild(textArea);
          showNotification('Failed to copy. Please copy manually.');
          return false;
        }
      }
    }

    // AI Tools with improved auto-paste
    function createAIToolHandler(url, platform) {
      return async function() {
        // Generate prompt if needed
        if (!outputEl.value || !isConverted) {
          await generatePrompt();
        }
        
        // Copy to clipboard
        const copied = await copyToClipboard();
        if (!copied) return;
        
        // Show paste helper
        showPasteHelper(platform);
        
        // Open AI tool in new tab
        try {
          window.open(url, '_blank');
        } catch (err) {
          console.log('Could not open window:', err);
          showNotification(`${platform} blocked by popup blocker. Please allow popups.`);
        }
      };
    }

    // Export function
    document.getElementById('exportBtn').addEventListener('click', async () => {
      if (!outputEl.value) await generatePrompt();
      
      const blob = new Blob([outputEl.value], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `prompt-${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Prompt exported as .txt file');
    });

    // Event listeners
    document.getElementById("convertBtn").addEventListener("click", generatePrompt);
    document.getElementById("copyBtn").addEventListener("click", async () => {
      if (!outputEl.value) await generatePrompt();
      await copyToClipboard();
      showNotification('Prompt copied to clipboard!');
    });

    // AI Tools handlers
    document.getElementById("claudeBtn").addEventListener("click", 
      createAIToolHandler("https://claude.ai/new", "Claude"));
    
    document.getElementById("chatgptBtn").addEventListener("click", 
      createAIToolHandler("https://chat.openai.com/", "ChatGPT"));
    
    document.getElementById("geminiBtn").addEventListener("click", 
      createAIToolHandler("https://gemini.google.com/app", "Gemini"));
    
    document.getElementById("perplexityBtn").addEventListener("click", 
      createAIToolHandler("https://www.perplexity.ai/", "Perplexity"));
    
    document.getElementById("deepseekBtn").addEventListener("click", 
      createAIToolHandler("https://chat.deepseek.com/", "DeepSeek"));

    // Initialize
    loadHistory();
    updateStats('');
    
    // Focus on input
    requirementEl.focus();

    // Browser compatibility check
    if (!navigator.clipboard) {
      showNotification('Clipboard API not supported. Using fallback method.');
    }
  </script>
</body>
</html>
