<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prompt Crafter Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Identity Services Library -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root{
      --bg:#f4f6ff;
      --card:#ffffff;
      --text:#121826;
      --muted:#6b7280;
      --brand:#4f46e5;
      --brand-2:#22c55e;
      --brand-3:#0284c7;
      --brand-4:#7c3aed;
      --brand-5:#f97316;
      --brand-6:#10b981;
      --ring:rgba(79,70,229,.25);
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }
    .container{max-width:1000px;margin:32px auto;padding:0 20px}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
    .logo{
      width:36px;height:36px;border-radius:10px;
      background: conic-gradient(from 180deg at 50% 50%, #06b6d4, #f59e0b, #ef4444, #06b6d4);
      display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:18px;
    }
    h1{font-size:28px;margin:0}
    .subtitle{color:var(--muted);font-size:14px;margin:6px 0 0}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;
      box-shadow:0 1px 1px rgba(0,0,0,.02), 0 6px 24px rgba(0,0,0,.04);
      padding:18px 18px;
      margin-bottom:16px;
    }
    .section-title{font-weight:600;margin:2px 0 10px;display:flex;align-items:center;justify-content:space-between;gap:8px;}
    .section-title i{color:var(--brand)}
    .section-title .actions{display:flex;gap:8px;}
    textarea, .output{
      width:100%;border:1px solid var(--border);border-radius:12px;background:#fff;color:var(--text);
      padding:14px;font-size:14px;outline:none;resize:vertical;min-height:120px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    textarea:focus, .output:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
    .btn{
      user-select:none;display:inline-flex;align-items:center;justify-content:center;
      gap:8px;padding:12px 16px;border-radius:12px;border:0;cursor:pointer;font-weight:600;color:#fff;
      transition:.18s transform ease, .18s opacity ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.convert{background:var(--brand);width:100%;margin:14px 0}
    .btn.convert:disabled{opacity:0.6;cursor:not-allowed;}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .btn.small{padding:10px 14px;font-size:14px;border-radius:10px}
    .btn.copy{background:#111827}
    .btn.claude{background:#111827}
    .btn.chatgpt{background:var(--brand-3)}
    .btn.gemini{background:var(--brand-4)}
    .btn.perplexity{background:var(--brand-5)}
    .btn.deepseek{background:var(--brand-6)}
    .btn.export{background:var(--brand-2)}
    .btn.history{background:#6b7280}
    .btn.templates{background:#8b5cf6}
    .btn.settings{background:#6b7280}
    .btn.google{background:#ffffff;color:#333;border:1px solid #dadce0;display:flex;align-items:center;gap:8px;}
    .btn.google:hover{background:#f8f9fa}
    .btn.google img{width:18px;height:18px;}
    .muted{color:var(--muted);font-size:12px;margin-top:10px}
    .howto li{margin:6px 0}
    .topbar{
      display:flex;justify-content:space-between;align-items:center;margin:10px 0 18px;
    }
    .api-box{display:flex;gap:8px;align-items:center;display:none;}
    .api-box.show{display:flex;}
    .api-input{
      width:320px;max-width:60vw;
      border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:13px;outline:none;background:#fff;
    }
    .api-input:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
    .btn.save{background:#10b981}
    .btn.logout{background:#ef4444}
    .footer{color:var(--muted);font-size:12px;margin:18px 0;text-align:center}
    
    /* User profile */
    .user-profile{display:flex;align-items:center;gap:8px;}
    .user-avatar{
      width:32px;height:32px;border-radius:50%;background:#4f46e5;
      display:flex;align-items:center;justify-content:center;color:white;font-weight:600;
      overflow:hidden;
    }
    .user-avatar img{width:100%;height:100%;object-fit:cover;}
    .user-info{display:flex;flex-direction:column;}
    .user-name{font-size:14px;font-weight:500;}
    .user-email{font-size:12px;color:var(--muted);}
    
    /* New Styles */
    .examples{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    .example-btn{
      background:#f3f4f6;border:1px solid var(--border);border-radius:8px;
      padding:6px 12px;font-size:12px;cursor:pointer;transition:all 0.2s;
    }
    .example-btn:hover{background:#e5e7eb}
    
    .preset-selector{margin:12px 0}
    .preset-option{
      display:inline-flex;align-items:center;gap:6px;margin-right:12px;
      padding:6px 12px;background:#f3f4f6;border-radius:8px;cursor:pointer;
      font-size:13px;
    }
    .preset-option.active{background:var(--brand);color:white}
    
    .history-panel{display:none;margin-top:12px;border-top:1px solid var(--border);padding-top:12px}
    .history-item{
      background:#f9fafb;padding:8px 12px;margin-bottom:6px;border-radius:8px;
      border-left:3px solid var(--brand);cursor:pointer;font-size:13px;
      display:flex;justify-content:space-between;align-items:center;
    }
    .history-item:hover{background:#f3f4f6}
    
    .tooltip{
      position:relative;display:inline-block;
    }
    .tooltip .tooltiptext{
      visibility:hidden;width:200px;background-color:#111827;color:#fff;
      text-align:center;border-radius:6px;padding:5px;position:absolute;
      z-index:1;bottom:125%;left:50%;margin-left:-100px;font-size:12px;
      opacity:0;transition:opacity 0.3s;
    }
    .tooltip:hover .tooltiptext{visibility:visible;opacity:1}
    
    .stats{font-size:12px;color:var(--muted);margin-top:8px}
    
    .auto-convert{display:flex;align-items:center;gap:8px;margin:10px 0;font-size:13px}
    .auto-convert input{width:16px;height:16px}
    
    .notification{
      position:fixed;bottom:20px;right:20px;background:var(--brand-2);color:white;
      padding:12px 16px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
      display:none;align-items:center;gap:8px;z-index:1000;
    }
    
    .converted-badge{
      display:inline-flex;align-items:center;gap:4px;
      background:#dcfce7;color:#166534;padding:4px 8px;border-radius:6px;
      font-size:12px;margin-left:8px;
    }
    
    .timer-display{
      font-size:11px;color:var(--muted);margin-left:8px;
      display:inline-flex;align-items:center;gap:2px;
    }
    
    /* Template Library Styles */
    .template-categories{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .template-category{
      background:#f3f4f6;padding:6px 12px;border-radius:20px;font-size:12px;
      cursor:pointer;transition:all 0.2s;
    }
    .template-category.active{background:var(--brand);color:white}
    
    .templates-grid{
      display:grid;grid-template-columns:repeat(auto-fill, minmax(280px, 1fr));
      gap:12px;margin-top:12px;
    }
    
    .template-card{
      background:white;border:1px solid var(--border);border-radius:10px;
      padding:14px;cursor:pointer;transition:all 0.2s;
      display:flex;flex-direction:column;height:100%;
    }
    .template-card:hover{
      transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.08);
      border-color:var(--brand);
    }
    
    .template-icon{
      width:36px;height:36px;border-radius:8px;display:flex;
      align-items:center;justify-content:center;margin-bottom:10px;
      color:white;font-size:16px;
    }
    
    .template-title{font-weight:600;margin-bottom:6px;font-size:14px}
    .template-desc{font-size:12px;color:var(--muted);margin-bottom:10px;flex-grow:1}
    .template-meta{display:flex;justify-content:space-between;font-size:11px;color:var(--muted)}
    
    .template-modal{
      display:none;position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);z-index:3000;align-items:center;justify-content:center;
      padding:20px;
    }
    
    .template-modal-content{
      background:white;border-radius:14px;width:100%;max-width:600px;
      max-height:90vh;overflow-y:auto;position:relative;
    }
    
    .template-modal-header{
      padding:20px;border-bottom:1px solid var(--border);
      display:flex;justify-content:space-between;align-items:center;
    }
    
    .template-modal-body{padding:20px;}
    
    .form-group{margin-bottom:16px;}
    .form-label{display:block;margin-bottom:6px;font-weight:500;font-size:14px}
    .form-input{
      width:100%;padding:10px;border:1px solid var(--border);
      border-radius:8px;font-size:14px;
    }
    .form-input:focus{border-color:var(--brand);outline:none}
    
    .tag{display:inline-flex;align-items:center;gap:4px;background:#f3f4f6;
      padding:4px 8px;border-radius:6px;font-size:12px;margin-right:6px;margin-bottom:6px;}
    
    .close-modal{background:none;border:none;font-size:20px;cursor:pointer;color:var(--muted)}
    
    /* Template actions */
    .template-actions{display:flex;gap:8px;margin-top:8px}
    .template-actions .btn.small{padding:6px 10px;font-size:12px}
    
    /* Search box */
    .search-box{
      width:100%;padding:10px 14px;border:1px solid var(--border);
      border-radius:8px;margin-bottom:12px;font-size:14px;
    }
    
    .empty-state{
      text-align:center;padding:40px 20px;color:var(--muted);
    }
    
    /* Settings modal */
    .settings-modal{
      display:none;position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);z-index:3000;align-items:center;justify-content:center;
      padding:20px;
    }
    
    .settings-modal-content{
      background:white;border-radius:14px;width:100%;max-width:500px;
      max-height:90vh;overflow-y:auto;
    }
    
    .settings-section{
      padding:20px;border-bottom:1px solid var(--border);
    }
    
    .settings-section:last-child{border-bottom:none;}
    
    .sync-status{display:flex;align-items:center;gap:8px;margin-top:10px;}
    .sync-badge{
      padding:4px 8px;border-radius:12px;font-size:11px;font-weight:500;
    }
    .sync-badge.synced{background:#dcfce7;color:#166534;}
    .sync-badge.not-synced{background:#fef3c7;color:#92400e;}
    
    /* Login prompt */
    .login-prompt{
      text-align:center;padding:30px 20px;
    }
    
    .login-prompt .logo{width:60px;height:60px;margin:0 auto 20px;}
    
    .features-list{text-align:left;margin:20px 0;}
    .features-list li{margin:8px 0;display:flex;align-items:center;gap:8px;}
    
    /* Cloud sync indicator */
    .cloud-indicator{
      position:fixed;bottom:10px;left:10px;background:white;
      padding:6px 10px;border-radius:8px;font-size:11px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;align-items:center;gap:6px;
      z-index:100;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="topbar">
      <div class="header">
        <div class="logo">PC</div>
        <div>
          <h1>Prompt Crafter Pro</h1>
          <div class="subtitle">Transform ideas into structured prompts · Created by Vijay Kumar</div>
        </div>
      </div>

      <div class="user-profile" id="userProfile" style="display:none">
        <div class="user-avatar" id="userAvatar">
          <!-- Avatar will be filled by JS -->
        </div>
        <div class="user-info">
          <div class="user-name" id="userName">User</div>
          <div class="user-email" id="userEmail">user@example.com</div>
        </div>
        <button class="btn small logout" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
      </div>

      <div class="api-box" id="apiBox">
        <input id="apiKey" class="api-input" type="password" placeholder="Enter your OpenAI API Key" />
        <button class="btn small save" id="saveKeyBtn">Save</button>
      </div>

      <div class="actions">
        <button class="btn small settings" id="settingsBtn"><i class="fas fa-cog"></i> Settings</button>
        <div id="googleSignIn" class="tooltip">
          <div id="g_id_onload"
            data-client_id="YOUR_GOOGLE_CLIENT_ID"
            data-context="signin"
            data-ux_mode="popup"
            data-callback="handleGoogleSignIn"
            data-auto_prompt="false">
          </div>
          <div class="g_id_signin"
            data-type="standard"
            data-shape="rectangular"
            data-theme="outline"
            data-text="signin_with"
            data-size="medium"
            data-logo_alignment="left"
            data-width="200">
          </div>
          <span class="tooltiptext">Sign in with Google to sync templates across devices</span>
        </div>
      </div>
    </div>

    <!-- LOGIN PROMPT (shown when not logged in) -->
    <div class="card" id="loginPromptCard">
      <div class="login-prompt">
        <div class="logo">PC</div>
        <h2>Welcome to Prompt Crafter Pro!</h2>
        <p>Sign in to unlock cloud sync and access your templates from anywhere.</p>
        
        <div style="margin:30px 0">
          <div id="manualGoogleSignin"></div>
        </div>
        
        <div class="features-list">
          <p><strong>Sign in to get:</strong></p>
          <ul>
            <li><i class="fas fa-cloud" style="color:#4f46e5"></i> <strong>Cloud Sync</strong> - Access templates anywhere</li>
            <li><i class="fas fa-history" style="color:#10b981"></i> <strong>Unlimited History</strong> - Never lose a prompt</li>
            <li><i class="fas fa-share-alt" style="color:#f59e0b"></i> <strong>Share Templates</strong> - Coming soon!</li>
            <li><i class="fas fa-mobile-alt" style="color:#8b5cf6"></i> <strong>Cross-Device Access</strong> - Use on phone & desktop</li>
          </ul>
        </div>
        
        <div style="margin-top:20px;font-size:12px;color:var(--muted)">
          <p>You can still use the tool without signing in, but your data will be stored locally only.</p>
          <button class="btn small" id="skipLoginBtn" style="margin-top:10px;background:#6b7280">Skip for now</button>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT (hidden until logged in or skipped) -->
    <div id="mainContent" style="display:none">
      <!-- TEMPLATE LIBRARY -->
      <div class="card">
        <div class="section-title">
          <div><i class="fas fa-layer-group"></i> Template Library</div>
          <div class="actions">
            <button class="btn small templates" id="newTemplateBtn"><i class="fas fa-plus"></i> New Template</button>
            <button class="btn small templates" id="toggleTemplatesBtn"><i class="fas fa-eye"></i> Show</button>
          </div>
        </div>
        
        <div id="templatesPanel" style="display:none">
          <input type="text" id="templateSearch" class="search-box" placeholder="Search templates...">
          
          <div class="template-categories" id="templateCategories">
            <!-- Categories will be populated by JS -->
          </div>
          
          <div class="templates-grid" id="templatesGrid">
            <!-- Templates will be populated by JS -->
          </div>
          
          <div id="emptyTemplates" class="empty-state" style="display:none">
            <i class="fas fa-inbox" style="font-size:48px;margin-bottom:12px;opacity:0.5"></i>
            <p>No templates found. Create your first template!</p>
          </div>
        </div>
      </div>

      <!-- QUICK EXAMPLES -->
      <div class="card">
        <div class="section-title"><i class="fas fa-bolt"></i> Quick Examples</div>
        <div class="examples">
          <button class="example-btn" data-example="Write a professional email to my team about the deadline extension">Email</button>
          <button class="example-btn" data-example="Create a Python function to calculate Fibonacci sequence">Code</button>
          <button class="example-btn" data-example="Analyze the market trends for electric vehicles in 2024">Analysis</button>
          <button class="example-btn" data-example="Write a blog post about the benefits of meditation">Blog Post</button>
          <button class="example-btn" data-example="Design a workout plan for beginners">Workout Plan</button>
        </div>
      </div>

      <!-- INPUT CARD -->
      <div class="card">
        <div class="section-title"><i class="fas fa-edit"></i> Your Requirement
          <span id="convertedBadge" class="converted-badge" style="display:none">
            <i class="fas fa-check-circle"></i> Converted
          </span>
          <span id="timerDisplay" class="timer-display" style="display:none">
            <i class="fas fa-clock"></i> <span id="timerValue">60s</span>
          </span>
        </div>
        
        <div class="auto-convert">
          <input type="checkbox" id="autoConvert" checked>
          <label for="autoConvert">Auto-convert as I type (60s delay)</label>
        </div>
        
        <textarea id="requirement" placeholder="Type your requirement here..."></textarea>
        <button id="convertBtn" class="btn convert"><i class="fas fa-magic"></i> Convert to Prompt</button>
      </div>

      <!-- PRESET SELECTOR -->
      <div class="card">
        <div class="section-title"><i class="fas fa-sliders-h"></i> Prompt Style</div>
        <div class="preset-selector">
          <div class="preset-option active" data-preset="default">
            <i class="fas fa-check-circle"></i> Standard
          </div>
          <div class="preset-option" data-preset="claude">
            <i class="fas fa-robot"></i> Claude Optimized
          </div>
          <div class="preset-option" data-preset="chatgpt">
            <i class="fas fa-comment"></i> ChatGPT Optimized
          </div>
        </div>
      </div>

      <!-- OUTPUT CARD -->
      <div class="card">
        <div class="section-title"><i class="fas fa-code"></i> Generated Prompt</div>
        <textarea id="output" class="output" readonly placeholder="Your formatted prompt will appear here..."></textarea>
        
        <div class="stats">
          <span id="charCount">0 characters</span> • 
          <span id="wordCount">0 words</span> • 
          <span id="lineCount">0 lines</span>
        </div>

        <div style="height:12px"></div>
        <div class="row">
          <button class="btn small copy" id="copyBtn"><i class="fas fa-copy"></i> Copy</button>
          <div class="tooltip">
            <button class="btn small chatgpt" id="chatgptBtn"><i class="fas fa-paper-plane"></i> ChatGPT</button>
            <span class="tooltiptext">Opens ChatGPT with prompt ready to paste</span>
          </div>
          <div class="tooltip">
            <button class="btn small claude" id="claudeBtn"><i class="fas fa-paper-plane"></i> Claude</button>
            <span class="tooltiptext">Opens Claude with prompt ready to paste</span>
          </div>
          <div class="tooltip">
            <button class="btn small gemini" id="geminiBtn"><i class="fas fa-paper-plane"></i> Gemini</button>
            <span class="tooltiptext">Opens Gemini with prompt ready to paste</span>
          </div>
          <div class="tooltip">
            <button class="btn small perplexity" id="perplexityBtn"><i class="fas fa-paper-plane"></i> Perplexity</button>
            <span class="tooltiptext">Opens Perplexity with prompt ready to paste</span>
          </div>
          <div class="tooltip">
            <button class="btn small deepseek" id="deepseekBtn"><i class="fas fa-paper-plane"></i> DeepSeek</button>
            <span class="tooltiptext">Opens DeepSeek with prompt ready to paste</span>
          </div>
          <button class="btn small export" id="exportBtn"><i class="fas fa-download"></i> Export</button>
          <button class="btn small history" id="toggleHistoryBtn"><i class="fas fa-history"></i> History</button>
          <button class="btn small templates" id="saveAsTemplateBtn"><i class="fas fa-save"></i> Save as Template</button>
        </div>
        
        <div class="history-panel" id="historyPanel">
          <div style="font-size:13px;margin-bottom:8px;color:var(--muted)">Recent prompts (click to reuse):</div>
          <div id="historyList"></div>
        </div>
      </div>

      <!-- HOW TO USE -->
      <div class="card">
        <div class="section-title"><i class="fas fa-info-circle"></i> How to Use</div>
        <ol class="howto">
          <li><b>Browse templates</b> or type your requirement</li>
          <li><b>Auto-converts</b> after 60 seconds (or click Convert)</li>
          <li><b>Click any AI button</b> - prompt auto-copies and tool opens</li>
          <li><b>Save successful prompts</b> as templates for reuse</li>
        </ol>
        <div class="footer">
          Uses fine-tuned AI model for optimal prompts • v2.3 • <span id="usageCount">0 prompts generated</span>
        </div>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div class="settings-modal" id="settingsModal">
    <div class="settings-modal-content">
      <div class="settings-section">
        <h3 style="margin:0 0 15px"><i class="fas fa-cog"></i> Settings</h3>
        
        <div class="form-group">
          <label class="form-label">OpenAI API Key</label>
          <div style="display:flex;gap:8px">
            <input type="password" id="settingsApiKey" class="form-input" placeholder="sk-...">
            <button class="btn small save" id="settingsSaveKeyBtn">Save</button>
          </div>
          <div class="muted">Your API key is stored locally and never sent to our servers.</div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Auto-Convert Delay</label>
          <select id="autoConvertDelay" class="form-input">
            <option value="30">30 seconds</option>
            <option value="60" selected>60 seconds</option>
            <option value="120">2 minutes</option>
            <option value="300">5 minutes</option>
            <option value="0">Off</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Default Prompt Style</label>
          <select id="defaultPreset" class="form-input">
            <option value="default">Standard</option>
            <option value="claude">Claude Optimized</option>
            <option value="chatgpt">ChatGPT Optimized</option>
          </select>
        </div>
      </div>
      
      <div class="settings-section">
        <h4 style="margin:0 0 10px"><i class="fas fa-cloud"></i> Cloud Sync</h4>
        
        <div id="syncStatus" class="sync-status">
          <div class="sync-badge not-synced" id="syncBadge">
            <i class="fas fa-cloud"></i> Not Synced
          </div>
          <button class="btn small" id="syncNowBtn" style="background:#4f46e5">
            <i class="fas fa-sync-alt"></i> Sync Now
          </button>
        </div>
        
        <div class="muted" style="margin-top:10px">
          <p>When signed in, your templates and history are backed up to the cloud.</p>
          <p>Last sync: <span id="lastSyncTime">Never</span></p>
        </div>
      </div>
      
      <div class="settings-section">
        <h4 style="margin:0 0 10px"><i class="fas fa-database"></i> Data Management</h4>
        
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn small" id="exportDataBtn" style="background:#10b981">
            <i class="fas fa-download"></i> Export All Data
          </button>
          <button class="btn small" id="importDataBtn" style="background:#f59e0b">
            <i class="fas fa-upload"></i> Import Data
          </button>
          <button class="btn small" id="clearDataBtn" style="background:#ef4444">
            <i class="fas fa-trash"></i> Clear Local Data
          </button>
        </div>
        
        <div class="muted" style="margin-top:10px">
          <p>Export your templates and prompts as a backup file.</p>
          <p>Warning: Clearing data cannot be undone.</p>
        </div>
      </div>
      
      <div style="padding:20px;text-align:right">
        <button class="btn" id="closeSettingsBtn" style="background:#6b7280">Close</button>
      </div>
    </div>
  </div>

  <!-- TEMPLATE MODAL -->
  <div class="template-modal" id="templateModal">
    <div class="template-modal-content">
      <div class="template-modal-header">
        <h3 style="margin:0" id="modalTitle">New Template</h3>
        <button class="close-modal" id="closeModalBtn">&times;</button>
      </div>
      <div class="template-modal-body">
        <div class="form-group">
          <label class="form-label">Template Name</label>
          <input type="text" id="templateName" class="form-input" placeholder="e.g., Professional Email Template">
        </div>
        
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="templateDescription" class="form-input" rows="3" placeholder="Describe what this template is for..."></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Prompt Content</label>
          <textarea id="templateContent" class="form-input" rows="6" placeholder="Paste your prompt template here..."></textarea>
        </div>
        
        <div class="form-group">
          <label class="form-label">Category</label>
          <select id="templateCategory" class="form-input">
            <option value="communication">Communication</option>
            <option value="coding">Coding</option>
            <option value="writing">Writing</option>
            <option value="analysis">Analysis</option>
            <option value="business">Business</option>
            <option value="creative">Creative</option>
            <option value="education">Education</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Tags (comma separated)</label>
          <input type="text" id="templateTags" class="form-input" placeholder="email, professional, team">
          <div id="tagsPreview" style="margin-top:8px"></div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Example Usage</label>
          <textarea id="templateExample" class="form-input" rows="3" placeholder="Show how to use this template..."></textarea>
        </div>
        
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:20px">
          <button class="btn small" id="cancelTemplateBtn" style="background:#6b7280">Cancel</button>
          <button class="btn small" id="saveTemplateBtn" style="background:#4f46e5">Save Template</button>
        </div>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION -->
  <div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationText">Copied to clipboard!</span>
  </div>

  <!-- PASTE HELPER POPUP -->
  <div id="pasteHelper" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:30px; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:2000; max-width:400px; width:90%;">
    <div style="text-align:center;">
      <i class="fas fa-clipboard-check" style="font-size:48px; color:#10b981; margin-bottom:15px;"></i>
      <h3 style="margin:0 0 10px;">Prompt Ready!</h3>
      <p style="color:#666; margin-bottom:20px; line-height:1.5;">Your prompt has been copied to clipboard.</p>
      <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:20px; text-align:left;">
        <div style="font-size:13px; color:#666; margin-bottom:5px;">Next steps:</div>
        <ol style="margin:0; padding-left:20px; font-size:14px;">
          <li>Go to the opened AI tool tab</li>
          <li>Click in the input box</li>
          <li>Press <strong>Ctrl+V</strong> (or Cmd+V on Mac)</li>
          <li>Press <strong>Enter</strong> to submit</li>
        </ol>
      </div>
      <div style="display:flex; gap:10px; justify-content:center;">
        <button id="closeHelper" style="padding:10px 20px; background:#4f46e5; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600;">Got it!</button>
        <button id="copyAgainBtn" style="padding:10px 20px; background:#f3f4f6; border:1px solid #e5e7eb; border-radius:8px; cursor:pointer;">Copy Again</button>
      </div>
    </div>
  </div>
  <div id="overlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1999;"></div>

  <!-- CLOUD SYNC INDICATOR -->
  <div class="cloud-indicator" id="cloudIndicator" style="display:none">
    <i class="fas fa-cloud"></i>
    <span id="cloudStatus">Syncing...</span>
  </div>

  <script>
    const OPENAI_API_URL = "https://api.openai.com/v1/chat/completions";
    const OPENAI_MODEL = "ft:gpt-3.5-turbo-1106:personal::CkAjxivm";
    
    // Replace with your actual Google Client ID
    const GOOGLE_CLIENT_ID = "YOUR_GOOGLE_CLIENT_ID_HERE";
    
    // Global variables
    let currentPreset = 'default';
    let autoConvertEnabled = true;
    let autoConvertDelay = 60000; // 60 seconds
    let debounceTimer;
    let usageCount = 0;
    let lastConvertedText = '';
    let isConverted = false;
    let autoConvertTimer;
    let autoConvertCountdown = 60;
    let countdownInterval;
    let editingTemplateId = null;
    let isLoggedIn = false;
    let userProfile = null;
    let cloudSyncEnabled = false;

    // Template categories with icons and colors
    const TEMPLATE_CATEGORIES = {
      'communication': { name: 'Communication', icon: 'fa-envelope', color: '#3b82f6' },
      'coding': { name: 'Coding', icon: 'fa-code', color: '#10b981' },
      'writing': { name: 'Writing', icon: 'fa-pen', color: '#8b5cf6' },
      'analysis': { name: 'Analysis', icon: 'fa-chart-bar', color: '#f59e0b' },
      'business': { name: 'Business', icon: 'fa-briefcase', color: '#ef4444' },
      'creative': { name: 'Creative', icon: 'fa-palette', color: '#ec4899' },
      'education': { name: 'Education', icon: 'fa-graduation-cap', color: '#06b6d4' },
      'other': { name: 'Other', icon: 'fa-th', color: '#6b7280' }
    };

    // Default templates
    const DEFAULT_TEMPLATES = [
      {
        id: '1',
        name: 'Professional Email',
        description: 'Write clear, professional emails for business communication',
        category: 'communication',
        tags: ['email', 'professional', 'business'],
        content: `# Role\nYou are an expert business communicator skilled in writing professional emails.\n\n# Objective\nWrite a professional email about [TOPIC] to [RECIPIENT]\n\n# Context\n- Recipient: [DESCRIBE RECIPIENT]\n- Relationship: [DESCRIBE RELATIONSHIP]\n- Purpose: [EMAIL PURPOSE]\n\n# Instructions\n1. Use professional but friendly tone\n2. Start with appropriate greeting\n3. State purpose clearly in first paragraph\n4. Provide necessary details\n5. Include clear call to action\n6. End with professional closing\n\n# Notes\n- Keep it concise (150-200 words)\n- Use proper email formatting\n- Include subject line\n- Check for tone appropriateness`,
        example: 'Write a professional email to my manager requesting a meeting to discuss project timeline adjustments.',
        usageCount: 0,
        createdAt: Date.now() - 86400000,
        isDefault: true
      }
    ];

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      checkLoginStatus();
      initializeApp();
    });

    // Check if user is logged in
    function checkLoginStatus() {
      const savedUser = localStorage.getItem('promptCrafterUser');
      const savedApiKey = localStorage.getItem('OPENAI_API_KEY');
      
      if (savedUser) {
        try {
          userProfile = JSON.parse(savedUser);
          isLoggedIn = true;
          showMainContent();
          updateUserProfile();
        } catch (e) {
          console.error('Error parsing user data:', e);
          localStorage.removeItem('promptCrafterUser');
        }
      }
      
      // Show/hide API key box based on saved key
      if (savedApiKey) {
        document.getElementById('apiKey').value = savedApiKey;
      }
    }

    // Show main content
    function showMainContent() {
      document.getElementById('loginPromptCard').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      
      if (isLoggedIn) {
        document.getElementById('userProfile').style.display = 'flex';
        document.getElementById('googleSignIn').style.display = 'none';
        document.getElementById('cloudIndicator').style.display = 'flex';
        updateCloudStatus('Connected to cloud');
      } else {
        document.getElementById('userProfile').style.display = 'none';
        document.getElementById('googleSignIn').style.display = 'block';
      }
    }

    // Update user profile display
    function updateUserProfile() {
      if (!userProfile) return;
      
      const avatar = document.getElementById('userAvatar');
      const name = document.getElementById('userName');
      const email = document.getElementById('userEmail');
      
      name.textContent = userProfile.name || 'User';
      email.textContent = userProfile.email || '';
      
      if (userProfile.picture) {
        avatar.innerHTML = `<img src="${userProfile.picture}" alt="${userProfile.name}">`;
      } else {
        const initials = userProfile.name ? userProfile.name.charAt(0).toUpperCase() : 'U';
        avatar.innerHTML = initials;
        avatar.style.background = '#4f46e5';
      }
    }

    // Handle Google Sign-In
    window.handleGoogleSignIn = function(response) {
      // Decode the JWT token to get user info
      const responsePayload = decodeJWTResponse(response.credential);
      
      userProfile = {
        id: responsePayload.sub,
        name: responsePayload.name,
        email: responsePayload.email,
        picture: responsePayload.picture,
        token: response.credential
      };
      
      localStorage.setItem('promptCrafterUser', JSON.stringify(userProfile));
      isLoggedIn = true;
      
      showNotification(`Welcome, ${userProfile.name}!`);
      showMainContent();
      updateUserProfile();
      
      // Try to sync data from cloud
      syncFromCloud();
    };

    // Decode JWT token (simplified)
    function decodeJWTResponse(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      
      return JSON.parse(jsonPayload);
    }

    // Manual Google Sign-in button
    function createManualGoogleButton() {
      const container = document.getElementById('manualGoogleSignin');
      container.innerHTML = `
        <button class="btn google" id="manualGoogleBtn">
          <img src="https://www.google.com/favicon.ico" alt="Google">
          Sign in with Google
        </button>
      `;
      
      document.getElementById('manualGoogleBtn').addEventListener('click', function() {
        // Trigger Google's sign-in flow
        google.accounts.id.prompt();
      });
    }

    // Skip login
    document.getElementById('skipLoginBtn').addEventListener('click', function() {
      showMainContent();
      showNotification('Using local storage only. Sign in later for cloud sync.');
    });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', function() {
      if (confirm('Are you sure you want to sign out?')) {
        // Clear Google session
        if (window.google && google.accounts.id) {
          google.accounts.id.disableAutoSelect();
        }
        
        // Clear local user data
        localStorage.removeItem('promptCrafterUser');
        userProfile = null;
        isLoggedIn = false;
        
        // Reset UI
        document.getElementById('userProfile').style.display = 'none';
        document.getElementById('googleSignIn').style.display = 'block';
        document.getElementById('cloudIndicator').style.display = 'none';
        
        showNotification('Signed out successfully');
      }
    });

    // Sync to cloud
    function syncToCloud() {
      if (!isLoggedIn) {
        showNotification('Sign in to enable cloud sync');
        return;
      }
      
      updateCloudStatus('Syncing...');
      
      // Simulate cloud sync (in real app, this would be an API call)
      setTimeout(() => {
        const syncData = {
          templates: JSON.parse(localStorage.getItem('promptTemplates') || '[]'),
          history: JSON.parse(localStorage.getItem('promptHistory') || '[]'),
          settings: {
            apiKey: localStorage.getItem('OPENAI_API_KEY'),
            usageCount: localStorage.getItem('promptCrafterUsage'),
            lastSync: Date.now()
          }
        };
        
        // Save to localStorage as cloud backup
        localStorage.setItem(`cloudBackup_${userProfile.id}`, JSON.stringify(syncData));
        localStorage.setItem('lastSyncTime', new Date().toLocaleString());
        
        updateCloudStatus('Synced just now');
        document.getElementById('lastSyncTime').textContent = new Date().toLocaleString();
        document.getElementById('syncBadge').className = 'sync-badge synced';
        document.getElementById('syncBadge').innerHTML = '<i class="fas fa-cloud"></i> Synced';
        
        showNotification('Data synced to cloud');
      }, 1000);
    }

    // Sync from cloud
    function syncFromCloud() {
      if (!isLoggedIn) return;
      
      const backup = localStorage.getItem(`cloudBackup_${userProfile.id}`);
      if (backup) {
        try {
          const data = JSON.parse(backup);
          
          // Merge templates (keep newer versions)
          const localTemplates = JSON.parse(localStorage.getItem('promptTemplates') || '[]');
          const cloudTemplates = data.templates || [];
          
          // Simple merge: prefer cloud templates for now
          const mergedTemplates = [...cloudTemplates];
          localStorage.setItem('promptTemplates', JSON.stringify(mergedTemplates));
          
          // Update last sync time
          document.getElementById('lastSyncTime').textContent = new Date(data.settings?.lastSync || Date.now()).toLocaleString();
          
          showNotification('Data restored from cloud');
        } catch (e) {
          console.error('Error restoring from cloud:', e);
        }
      }
    }

    // Update cloud status indicator
    function updateCloudStatus(status) {
      document.getElementById('cloudStatus').textContent = status;
    }

    // Settings
    document.getElementById('settingsBtn').addEventListener('click', function() {
      document.getElementById('settingsModal').style.display = 'flex';
      loadSettings();
    });

    document.getElementById('closeSettingsBtn').addEventListener('click', function() {
      document.getElementById('settingsModal').style.display = 'none';
    });

    // Load settings
    function loadSettings() {
      const savedDelay = localStorage.getItem('autoConvertDelay') || '60';
      const savedPreset = localStorage.getItem('defaultPreset') || 'default';
      const savedApiKey = localStorage.getItem('OPENAI_API_KEY') || '';
      const lastSync = localStorage.getItem('lastSyncTime') || 'Never';
      
      document.getElementById('autoConvertDelay').value = savedDelay;
      document.getElementById('defaultPreset').value = savedPreset;
      document.getElementById('settingsApiKey').value = savedApiKey;
      document.getElementById('lastSyncTime').textContent = lastSync;
      
      // Update sync badge
      const syncBadge = document.getElementById('syncBadge');
      if (isLoggedIn) {
        syncBadge.className = lastSync === 'Never' ? 'sync-badge not-synced' : 'sync-badge synced';
        syncBadge.innerHTML = lastSync === 'Never' ? 
          '<i class="fas fa-cloud"></i> Not Synced' : 
          '<i class="fas fa-cloud"></i> Synced';
      } else {
        syncBadge.className = 'sync-badge not-synced';
        syncBadge.innerHTML = '<i class="fas fa-cloud-slash"></i> Sign in to sync';
      }
    }

    // Save settings
    document.getElementById('settingsSaveKeyBtn').addEventListener('click', function() {
      const apiKey = document.getElementById('settingsApiKey').value.trim();
      localStorage.setItem('OPENAI_API_KEY', apiKey);
      showNotification('API key saved');
    });

    document.getElementById('autoConvertDelay').addEventListener('change', function() {
      const delay = parseInt(this.value);
      localStorage.setItem('autoConvertDelay', delay);
      autoConvertDelay = delay * 1000; // Convert to milliseconds
      autoConvertCountdown = delay;
      showNotification(`Auto-convert delay set to ${delay} seconds`);
    });

    document.getElementById('defaultPreset').addEventListener('change', function() {
      localStorage.setItem('defaultPreset', this.value);
      showNotification(`Default preset set to ${this.value}`);
    });

    // Sync now button
    document.getElementById('syncNowBtn').addEventListener('click', function() {
      if (isLoggedIn) {
        syncToCloud();
      } else {
        showNotification('Please sign in to use cloud sync');
      }
    });

    // Export data
    document.getElementById('exportDataBtn').addEventListener('click', function() {
      const data = {
        templates: JSON.parse(localStorage.getItem('promptTemplates') || '[]'),
        history: JSON.parse(localStorage.getItem('promptHistory') || '[]'),
        settings: {
          apiKey: localStorage.getItem('OPENAI_API_KEY'),
          usageCount: localStorage.getItem('promptCrafterUsage'),
          lastSync: localStorage.getItem('lastSyncTime')
        },
        exportedAt: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `prompt-crafter-backup-${Date.now()}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Data exported successfully');
    });

    // Import data
    document.getElementById('importDataBtn').addEventListener('click', function() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
          try {
            const data = JSON.parse(event.target.result);
            
            if (data.templates) {
              localStorage.setItem('promptTemplates', JSON.stringify(data.templates));
            }
            
            if (data.history) {
              localStorage.setItem('promptHistory', JSON.stringify(data.history));
            }
            
            if (data.settings) {
              if (data.settings.apiKey) {
                localStorage.setItem('OPENAI_API_KEY', data.settings.apiKey);
              }
              if (data.settings.usageCount) {
                localStorage.setItem('promptCrafterUsage', data.settings.usageCount);
              }
            }
            
            showNotification('Data imported successfully');
            location.reload(); // Refresh to load new data
          } catch (error) {
            showNotification('Error importing data: Invalid file format');
          }
        };
        
        reader.readAsText(file);
      };
      
      input.click();
    });

    // Clear data
    document.getElementById('clearDataBtn').addEventListener('click', function() {
      if (confirm('This will clear all local data (templates, history, settings). Continue?')) {
        localStorage.clear();
        showNotification('All local data cleared');
        setTimeout(() => location.reload(), 1000);
      }
    });

    // Initialize the rest of the app (from previous code)
    function initializeApp() {
      // Load saved data
      const savedKey = localStorage.getItem('OPENAI_API_KEY');
      if (savedKey) document.getElementById('apiKey').value = savedKey;
      
      // Load usage count
      const savedUsage = localStorage.getItem('promptCrafterUsage');
      if (savedUsage) {
        usageCount = parseInt(savedUsage);
        document.getElementById('usageCount').textContent = `${usageCount} prompts generated`;
      }
      
      // Load auto-convert delay
      const savedDelay = localStorage.getItem('autoConvertDelay') || '60';
      autoConvertDelay = parseInt(savedDelay) * 1000;
      autoConvertCountdown = parseInt(savedDelay);
      
      // Load default preset
      const savedPreset = localStorage.getItem('defaultPreset') || 'default';
      currentPreset = savedPreset;
      
      // Set active preset
      document.querySelectorAll('.preset-option').forEach(option => {
        option.classList.remove('active');
        if (option.dataset.preset === savedPreset) {
          option.classList.add('active');
        }
      });
      
      // Initialize Google Sign-In
      setTimeout(() => {
        if (window.google && google.accounts && google.accounts.id) {
          google.accounts.id.initialize({
            client_id: GOOGLE_CLIENT_ID,
            callback: handleGoogleSignIn,
            auto_select: false,
            cancel_on_tap_outside: true
          });
          
          // Render button
          google.accounts.id.renderButton(
            document.getElementById("manualGoogleSignin"),
            { theme: "outline", size: "large", width: "250" }
          );
          
          // Also render in the topbar
          google.accounts.id.renderButton(
            document.getElementById("googleSignIn"),
            { theme: "outline", size: "medium", width: "200" }
          );
        } else {
          createManualGoogleButton();
        }
      }, 1000);
      
      // Initialize templates
      initializeTemplates();
      
      // Show login prompt or main content
      if (!isLoggedIn) {
        document.getElementById('loginPromptCard').style.display = 'block';
      } else {
        showMainContent();
      }
      
      // Initialize the rest of the application
      // ... (rest of your existing initialization code goes here)
      // This includes all the template functions, generatePrompt, etc.
      // I've kept the core logic the same as before, just added authentication layer
    }

    // The rest of your existing JavaScript code follows here...
    // (All the template functions, generatePrompt, event listeners, etc.)
    // I've omitted it for brevity but it should be included from your previous version

    // Notification function
    function showNotification(message) {
      const notification = document.getElementById('notification');
      document.getElementById('notificationText').textContent = message;
      notification.style.display = 'flex';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Initialize when page loads
    window.addEventListener('load', function() {
      // If user is logged in, show main content immediately
      if (isLoggedIn) {
        showMainContent();
      }
      
      // Focus on requirement input
      setTimeout(() => {
        const requirementEl = document.getElementById('requirement');
        if (requirementEl) requirementEl.focus();
      }, 100);
    });

    // Note: For actual Google Sign-In to work, you need to:
    // 1. Create a project at https://console.cloud.google.com/
    // 2. Enable Google Sign-In API
    // 3. Create OAuth 2.0 credentials
    // 4. Add your domain to authorized origins
    // 5. Replace GOOGLE_CLIENT_ID with your actual client ID

  </script>
</body>
</html>
